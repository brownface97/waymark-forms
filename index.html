<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Waymark Immigration - Client Intake Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --color-red: #D42426;
            --color-blue: #2563EB;
            --color-green: #059669;
            --color-orange: #F59E0B;
            --color-purple: #7C3AED;
            --color-dark: #1E293B;
            --color-cyan: #06B6D4;
            --glass-bg: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(255, 255, 255, 0.9);
            --gradient-header: linear-gradient(135deg, var(--color-dark) 0%, var(--color-blue) 50%, var(--color-purple) 100%);
            --gradient-rainbow: linear-gradient(90deg, var(--color-red), var(--color-orange), var(--color-green), var(--color-blue), var(--color-purple), var(--color-red));
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 40px 20px;
            color: var(--color-dark);
            position: relative;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .bg-shapes {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .bg-shape {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.4;
            animation: floatShape 20s ease-in-out infinite;
        }

        .bg-shape:nth-child(1) {
            width: 600px; height: 600px;
            background: linear-gradient(135deg, var(--color-blue), var(--color-purple));
            top: -200px; left: -200px;
        }

        .bg-shape:nth-child(2) {
            width: 500px; height: 500px;
            background: linear-gradient(135deg, var(--color-red), var(--color-orange));
            top: 50%; right: -150px;
            animation-delay: -5s;
        }

        .bg-shape:nth-child(3) {
            width: 400px; height: 400px;
            background: linear-gradient(135deg, var(--color-green), var(--color-cyan));
            bottom: -100px; left: 30%;
            animation-delay: -10s;
        }

        @keyframes floatShape {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(50px, 50px) scale(1.1); }
            50% { transform: translate(0, 100px) scale(0.9); }
            75% { transform: translate(-50px, 50px) scale(1.05); }
        }

        .particles {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 6px; height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: particleFloat 15s linear infinite;
        }

        @keyframes particleFloat {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 32px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            overflow: hidden;
            position: relative;
            z-index: 10;
            animation: containerSlide 0.8s ease-out;
        }

        @keyframes containerSlide {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            background: var(--gradient-header);
            color: white;
            padding: 50px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            animation: patternMove 30s linear infinite;
        }

        @keyframes patternMove {
            0% { background-position: 0 0; }
            100% { background-position: 60px 60px; }
        }

        .header-content { position: relative; z-index: 1; }

        .logo {
            width: 200px;
            height: auto;
            margin-bottom: 20px;
            filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.4));
            animation: logoPulse 3s ease-in-out infinite;
        }

        @keyframes logoPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }

        .header h1 { 
            font-size: 38px; 
            font-weight: 900; 
            margin-bottom: 8px;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .header .subtitle { font-size: 18px; opacity: 0.9; font-weight: 500; }

        .rcic {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 13px;
            font-weight: 600;
            display: inline-block;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .rainbow-border {
            height: 6px;
            background: var(--gradient-rainbow);
            background-size: 200% 100%;
            animation: rainbowFlow 3s linear infinite;
        }

        @keyframes rainbowFlow {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        .theme-red { border-left-color: var(--color-red) !important; }
        .theme-blue { border-left-color: var(--color-blue) !important; }
        .theme-green { border-left-color: var(--color-green) !important; }
        .theme-orange { border-left-color: var(--color-orange) !important; }
        .theme-purple { border-left-color: var(--color-purple) !important; }
        .theme-dark { border-left-color: var(--color-dark) !important; }

        .controls {
            padding: 30px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.6));
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .controls label { 
            font-size: 16px; 
            margin-bottom: 12px; 
            display: block; 
            font-weight: 800;
            color: var(--color-dark);
        }

        select {
            width: 100%;
            padding: 18px 20px;
            border-radius: 16px;
            border: 2px solid #e2e8f0;
            font-size: 16px;
            margin-bottom: 20px;
            font-weight: 600;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            -webkit-appearance: none;
            appearance: none;
        }

        select:hover { border-color: var(--color-blue); }
        select:focus { outline: none; border-color: var(--color-blue); box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1); }

        .action-bar {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            padding-top: 20px;
            border-top: 1px solid rgba(0, 0, 0, 0.08);
        }

        .btn {
            padding: 14px 28px;
            border-radius: 14px;
            border: none;
            cursor: pointer;
            font-weight: 700;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .btn-primary { 
            background: linear-gradient(135deg, var(--color-blue), var(--color-purple)); 
            color: white; 
            box-shadow: 0 4px 20px rgba(37, 99, 235, 0.3);
        }
        .btn-primary:hover, .btn-primary:active { transform: translateY(-3px); box-shadow: 0 8px 30px rgba(37, 99, 235, 0.4); }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

        .btn-save { 
            background: linear-gradient(135deg, var(--color-green), #10b981); 
            color: white;
            box-shadow: 0 4px 20px rgba(5, 150, 105, 0.3);
        }
        .btn-save:hover, .btn-save:active { transform: translateY(-3px); box-shadow: 0 8px 30px rgba(5, 150, 105, 0.4); }

        .btn-share { 
            background: linear-gradient(135deg, var(--color-orange), #f97316); 
            color: white;
            box-shadow: 0 4px 20px rgba(249, 115, 22, 0.3);
        }
        .btn-share:hover, .btn-share:active { transform: translateY(-3px); box-shadow: 0 8px 30px rgba(249, 115, 22, 0.4); }

        .btn-outline { 
            background: white; 
            border: 2px solid #e2e8f0; 
            color: var(--color-dark);
        }
        .btn-outline:hover, .btn-outline:active { background: #f8fafc; border-color: var(--color-blue); transform: translateY(-2px); }

        .btn-add { 
            background: linear-gradient(135deg, var(--color-dark), #334155); 
            color: white; 
            padding: 12px 20px; 
            font-size: 13px;
        }
        .btn-add:hover, .btn-add:active { background: linear-gradient(135deg, var(--color-blue), var(--color-purple)); transform: translateY(-2px); }

        .btn-remove { 
            background: linear-gradient(135deg, #fef2f2, #fee2e2); 
            color: var(--color-red); 
            padding: 8px 16px; 
            font-size: 12px;
            border: 1px solid rgba(220, 38, 38, 0.2);
        }
        .btn-remove:hover, .btn-remove:active { background: var(--color-red); color: white; }

        .save-info {
            font-size: 13px;
            color: #64748b;
            font-weight: 600;
            margin-left: auto;
            padding: 8px 16px;
            background: #f1f5f9;
            border-radius: 10px;
        }

        .form-content { padding: 40px; }

        .form-section {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            border: 1px solid rgba(255, 255, 255, 0.8);
            padding: 35px;
            border-radius: 24px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.04);
            position: relative;
            overflow: hidden;
            animation: sectionSlide 0.6s ease-out backwards;
            transition: all 0.3s;
            border-left: 6px solid var(--color-blue);
        }

        @keyframes sectionSlide {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .section-title {
            font-size: 24px;
            font-weight: 900;
            margin-bottom: 25px;
            color: var(--color-dark);
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .section-title .icon { font-size: 28px; }

        .section-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            background: linear-gradient(135deg, var(--color-green), #10b981);
            color: white;
            border-radius: 50px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .points-badge { background: linear-gradient(135deg, var(--color-orange), #f59e0b); }

        .row { display: grid; gap: 20px; margin-bottom: 20px; }
        .row-2 { grid-template-columns: 1fr 1fr; }
        .row-3 { grid-template-columns: 1fr 1fr 1fr; }
        .row-4 { grid-template-columns: 1fr 1fr 1fr 1fr; }

        @media (max-width: 768px) {
            body { padding: 15px 10px; }
            .row-2, .row-3, .row-4 { grid-template-columns: 1fr; }
            .form-content { padding: 20px; }
            .form-section { padding: 20px; }
            .action-bar { flex-direction: column; align-items: stretch; }
            .save-info { margin-left: 0; text-align: center; margin-top: 10px; }
            .header h1 { font-size: 24px; }
            .header { padding: 30px 20px; }
            .logo { width: 150px; }
            .controls { padding: 20px; }
            .section-title { font-size: 18px; }
            .score-grid { grid-template-columns: repeat(2, 1fr); }
        }

        label { 
            display: block; 
            font-weight: 700; 
            margin-bottom: 10px; 
            font-size: 14px; 
            color: #334155;
        }

        .required { color: var(--color-red); }

        input, textarea, select {
            width: 100%;
            padding: 16px 18px;
            border: 2px solid #e2e8f0;
            border-radius: 14px;
            font-size: 16px;
            background: white;
            font-family: inherit;
            color: #1e293b;
            transition: all 0.3s;
            -webkit-appearance: none;
            appearance: none;
        }

        input:hover, select:hover, textarea:hover { border-color: #cbd5e1; }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--color-blue);
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
        }

        .conditional { 
            display: none; 
            background: linear-gradient(135deg, #f8fafc, #f1f5f9); 
            padding: 25px; 
            border-radius: 16px; 
            margin-top: 20px; 
            border: 2px dashed #cbd5e1;
        }
        .conditional.show { display: block; animation: fadeSlide 0.4s ease-out; }

        @keyframes fadeSlide {
            from { opacity: 0; transform: translateY(-15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .parent-box {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.08), rgba(249, 115, 22, 0.03));
            border: 2px solid rgba(249, 115, 22, 0.2);
            padding: 28px;
            border-radius: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }
        .parent-box h4 { font-size: 17px; font-weight: 800; color: var(--color-orange); margin-bottom: 18px; display: flex; align-items: center; gap: 10px; }

        .spouse-box {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.08), rgba(124, 58, 237, 0.03));
            border: 2px solid rgba(124, 58, 237, 0.2);
            padding: 28px;
            border-radius: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }
        .spouse-box h4 { font-size: 17px; font-weight: 800; color: var(--color-purple); margin-bottom: 18px; }

        .info-box {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(37, 99, 235, 0.03));
            border: 2px solid rgba(37, 99, 235, 0.2);
            padding: 28px;
            border-radius: 20px;
            margin-bottom: 20px;
        }
        .info-box h4 { font-size: 17px; font-weight: 800; color: var(--color-blue); margin-bottom: 18px; }

        .pr-box {
            background: linear-gradient(135deg, rgba(212, 36, 38, 0.08), rgba(212, 36, 38, 0.03));
            border: 2px solid rgba(212, 36, 38, 0.2);
            padding: 28px;
            border-radius: 20px;
            margin-bottom: 20px;
        }
        .pr-box h4 { font-size: 17px; font-weight: 800; color: var(--color-red); margin-bottom: 18px; }

        .green-box {
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.08), rgba(5, 150, 105, 0.03));
            border: 2px solid rgba(5, 150, 105, 0.2);
            padding: 28px;
            border-radius: 20px;
            margin-bottom: 20px;
        }
        .green-box h4 { font-size: 17px; font-weight: 800; color: var(--color-green); margin-bottom: 18px; }

        .exp-box {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(37, 99, 235, 0.03));
            border: 2px solid rgba(37, 99, 235, 0.2);
            padding: 28px;
            border-radius: 20px;
            margin-bottom: 20px;
        }
        .exp-box h4 { font-size: 17px; font-weight: 800; color: var(--color-blue); margin-bottom: 18px; }
        .exp-box.canadian { background: linear-gradient(135deg, rgba(212, 36, 38, 0.08), rgba(212, 36, 38, 0.03)); border-color: rgba(212, 36, 38, 0.2); }
        .exp-box.canadian h4 { color: var(--color-red); }

        .blood-box {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.08), rgba(236, 72, 153, 0.03));
            border: 2px solid rgba(236, 72, 153, 0.2);
            padding: 28px;
            border-radius: 20px;
            margin-bottom: 20px;
        }
        .blood-box h4 { font-size: 17px; font-weight: 800; color: #db2777; margin-bottom: 10px; }

        .points-highlight {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 700;
            color: #92400e;
            margin-bottom: 20px;
            border: 1px solid #fcd34d;
        }

        .relation-examples {
            background: #f8fafc;
            padding: 15px 20px;
            border-radius: 12px;
            font-size: 13px;
            color: #64748b;
            margin-bottom: 20px;
            border-left: 4px solid var(--color-purple);
            line-height: 1.7;
        }
        .relation-examples strong { color: #334155; }

        .repeater-item {
            background: white;
            padding: 28px;
            border-radius: 18px;
            margin-bottom: 15px;
            border: 2px solid #e2e8f0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03);
            transition: all 0.3s;
        }

        .repeater-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 20px; 
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9; 
        }
        .repeater-header strong { font-size: 16px; color: var(--color-blue); font-weight: 800; }

        .dynamic-section { margin-top: 30px; padding-top: 30px; border-top: 2px solid #e2e8f0; }
        .dynamic-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        .dynamic-header h4 { font-size: 18px; font-weight: 800; color: var(--color-dark); }

        .empty-msg {
            text-align: center;
            padding: 30px;
            color: #64748b;
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 16px;
            border: 2px dashed #cbd5e1;
            font-size: 14px;
        }

        .score-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .score-item { text-align: center; }
        .score-item label { font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .score-item input { text-align: center; font-weight: 700; font-size: 18px; }

        .sub-title {
            font-size: 15px;
            font-weight: 700;
            color: #475569;
            margin: 25px 0 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            padding: 18px 36px;
            background: linear-gradient(135deg, var(--color-green), #10b981);
            color: white;
            border-radius: 50px;
            font-weight: 700;
            font-size: 15px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
            max-width: 90%;
            text-align: center;
        }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        .toast.error { background: linear-gradient(135deg, var(--color-red), #dc2626); }

        /* Loading Overlay for Mobile */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 20px;
        }
        .loading-overlay.show { display: flex; }
        .loading-spinner {
            width: 60px; height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text {
            color: white;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
        }

    </style>
</head>
<body>

    <div class="bg-shapes">
        <div class="bg-shape"></div>
        <div class="bg-shape"></div>
        <div class="bg-shape"></div>
    </div>

    <div class="particles" id="particles"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">Processing your application...</div>
    </div>

    <div class="container">
        <div class="header">
            <div class="header-content">
                <img src="https://primary.jwwb.nl/public/l/k/m/temp-sxbxntzjbvhbpwedrnga/untitled-5-5-high.png?enable-io=true&crop=1.3333%3A1&width=816" alt="Waymark Logo" class="logo">
                <h1>Waymark Immigration</h1>
                <p class="subtitle">Secure Client Application Portal</p>
                <div class="rcic">üçÅ RCIC-IRB Licensed | R1034253</div>
            </div>
        </div>
        <div class="rainbow-border"></div>

        <div class="controls">
            <label>Select Application Type</label>
            <select id="formType" onchange="generateForm()">
                <option value="">-- Choose Application Type --</option>
                <optgroup label="üçÅ Permanent Residence">
                    <option value="express_entry">Express Entry Assessment</option>
                    <option value="pr_app">Provincial Nominee Program (PNP)</option>
                    <option value="sponsorship_spouse">Spousal Sponsorship</option>
                    <option value="sponsorship_parents">Parents & Grandparents Sponsorship</option>
                    <option value="pr_renewal">PR Card Renewal</option>
                </optgroup>
                <optgroup label="üõÇ Visitor">
                    <option value="visitor_outside">Visitor Visa (Outside Canada)</option>
                    <option value="visitor_inside">Visitor Record Extension (Inside Canada)</option>
                    <option value="super_visa">Super Visa (Parents/Grandparents)</option>
                </optgroup>
                <optgroup label="üìö Study">
                    <option value="study_outside">Study Permit (Outside Canada)</option>
                    <option value="study_inside">Study Permit Extension (Inside Canada)</option>
                </optgroup>
                <optgroup label="üíº Work">
                    <option value="lmia_outside">Work Permit - LMIA (Outside Canada)</option>
                    <option value="lmia_inside">Work Permit - LMIA (Inside Canada)</option>
                    <option value="pgwp">Post-Graduation Work Permit (PGWP)</option>
                    <option value="spousal_owp">Spousal Open Work Permit</option>
                    <option value="vulnerable_owp">Vulnerable Open Work Permit</option>
                </optgroup>
                <optgroup label="üèÜ Citizenship">
                    <option value="citizenship">Citizenship Application</option>
                </optgroup>
                <optgroup label="üõ°Ô∏è Refugee">
                    <option value="refugee_claim">Refugee Claim (In-Canada)</option>
                </optgroup>
                <optgroup label="üïäÔ∏è Humanitarian">
                    <option value="hc_application">Humanitarian & Compassionate (H&C) Application</option>
                </optgroup>
                <optgroup label="üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family">
                    <option value="family_info">Family Information (IMM 5645)</option>
                </optgroup>
                <optgroup label="üìã General">
                    <option value="client_profile">Client Profile ‚Äî Information Record</option>
                </optgroup>
            </select>

            <div class="action-bar">
                <button type="button" class="btn btn-save" onclick="saveToBrowser()">üíæ Save Progress</button>
                <button type="button" class="btn btn-outline" onclick="loadFromBrowser()">üìÇ Load Saved</button>
                <button type="button" class="btn btn-share" onclick="shareForm()">üîó Share Link</button>
                <button type="button" class="btn btn-outline" onclick="clearForm()">‚ôªÔ∏è Reset</button>
                <span class="save-info" id="lastSaved">Auto-save enabled</span>
            </div>
        </div>

        <form id="mainForm">
            <!-- Form content starts here -->

            <div id="formContent" class="form-content">
                <div style="text-align:center; color:#64748b; padding:60px 40px;">
                    <div style="font-size:60px; margin-bottom:20px;">üëã</div>
                    <h3 style="margin-bottom:15px; font-size:24px; color:#334155;">Welcome to Waymark Immigration</h3>
                    <p style="font-size:16px; line-height:1.7;">Please select an application type above to begin.</p>
                    <p style="margin-top:20px; font-size:14px; padding:15px 25px; background:#f1f5f9; border-radius:12px; display:inline-block;">üíæ Your progress is automatically saved to your browser</p>
                </div>
            </div>
            
            <div class="form-content" style="padding-top:0; display:none;" id="submitArea">
                <div class="form-section" style="text-align:center; border-left-color: var(--color-green);">
                    <p style="margin-bottom:20px; font-size:14px; color:#64748b;">üìÑ Clicking submit will generate a PDF and send your application to Waymark Immigration</p>
                    <button type="button" class="btn btn-primary" id="submitBtn" style="width:100%; max-width:400px; justify-content:center; padding: 20px 40px; font-size:18px;" onclick="handleSubmit()">‚úÖ Submit Application</button>
                    <p style="margin-top:15px; font-size:13px; color:#64748b;">Your PDF will automatically download</p>
                </div>
            </div>
        </form>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // Detect mobile
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        console.log('Device type:', isMobile ? 'Mobile' : 'Desktop');

        // Submit cooldown tracking
        let lastSubmitTime = 0;
        const SUBMIT_COOLDOWN = 5000; // 5 seconds

        // Create particles (fewer on mobile)
        function createParticles() {
            const container = document.getElementById('particles');
            const count = isMobile ? 10 : 30;
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                container.appendChild(particle);
            }
        }
        createParticles();

        // Form Configuration - Removed showVulnerableDetails from vulnerable_owp
        const FORM_CONFIG = {
            'express_entry': { 
                name: 'Express Entry Assessment', 
                showParents: false, showSpouse: true, showChildren: false, showSiblings: false,
                showEducation: true, showWork: true, showLanguage: true, showTravel: true,
                showCanadaEntry: false, showEmployer: false,
                showForeignExp: true, showCanadianExp: true, showBloodRelation: true,
                showSpouseDetails: true, isExpressEntry: true
            },
            'pr_app': { 
                name: 'PNP Application', 
                showParents: true, showSpouse: true, showChildren: true, showSiblings: true,
                showEducation: true, showWork: true, showLanguage: true, showTravel: true,
                showCanadaEntry: true, showEmployer: false
            },
            'sponsorship_spouse': {
                name: 'Spousal Sponsorship',
                showParents: true, showSpouse: true, showChildren: true, showSiblings: true,
                showEducation: true, showWork: true, showLanguage: false, showTravel: true,
                showCanadaEntry: false, showEmployer: false
            },
            'sponsorship_parents': {
                name: 'Parents Sponsorship',
                showParents: false, showSpouse: true, showChildren: true, showSiblings: false,
                showEducation: true, showWork: true, showLanguage: false, showTravel: true,
                showCanadaEntry: false, showEmployer: false
            },
            'pr_renewal': {
                name: 'PR Card Renewal',
                showParents: false, showSpouse: true, showChildren: false, showSiblings: false,
                showEducation: true, showWork: true, showLanguage: false, showTravel: false,
                showCanadaEntry: true, showEmployer: false,
                showPRDetails: true, showAbsences: true
            },
            'visitor_outside': {
                name: 'Visitor Visa (Outside)',
                showParents: true, showSpouse: true, showChildren: true, showSiblings: true,
                showEducation: true, showWork: true, showLanguage: false, showTravel: true,
                showCanadaEntry: false, showEmployer: false
            },
            'visitor_inside': {
                name: 'Visitor Record (Inside)',
                showParents: false, showSpouse: false, showChildren: false, showSiblings: false,
                showEducation: true, showWork: true, showLanguage: false, showTravel: false,
                showCanadaEntry: true, showEmployer: false
            },
            'super_visa': {
                name: 'Super Visa',
                showParents: false, showSpouse: true, showChildren: true, showSiblings: false,
                showEducation: true, showWork: true, showLanguage: false, showTravel: true,
                showCanadaEntry: false, showEmployer: false
            },
            'study_outside': {
                name: 'Study Permit (Outside)',
                showParents: true, showSpouse: true, showChildren: false, showSiblings: true,
                showEducation: true, showWork: true, showLanguage: true, showTravel: true,
                showCanadaEntry: false, showEmployer: false
            },
            'study_inside': {
                name: 'Study Permit (Inside)',
                showParents: false, showSpouse: false, showChildren: false, showSiblings: false,
                showEducation: true, showWork: true, showLanguage: false, showTravel: false,
                showCanadaEntry: true, showEmployer: false
            },
            'lmia_outside': {
                name: 'Work Permit LMIA (Outside)',
                showParents: true, showSpouse: true, showChildren: true, showSiblings: true,
                showEducation: true, showWork: true, showLanguage: true, showTravel: true,
                showCanadaEntry: false, showEmployer: true
            },
            'lmia_inside': {
                name: 'Work Permit LMIA (Inside)',
                showParents: false, showSpouse: false, showChildren: false, showSiblings: false,
                showEducation: true, showWork: true, showLanguage: false, showTravel: false,
                showCanadaEntry: true, showEmployer: true
            },
            'pgwp': {
                name: 'PGWP',
                showParents: false, showSpouse: false, showChildren: false, showSiblings: false,
                showEducation: true, showWork: true, showLanguage: false, showTravel: false,
                showCanadaEntry: true, showEmployer: false
            },
            'vulnerable_owp': {
                name: 'Vulnerable Open Work Permit',
                showParents: false, showSpouse: true, showChildren: true, showSiblings: false,
                showEducation: true, showWork: true, showLanguage: false, showTravel: false,
                showCanadaEntry: true, showEmployer: false
            },
            'spousal_owp': {
                name: 'Spousal Open Work Permit',
                showParents: false, showSpouse: true, showChildren: true, showSiblings: false,
                showEducation: true, showWork: true, showLanguage: false, showTravel: false,
                showCanadaEntry: true, showEmployer: false,
                showSpousalOWP: true
            },
            'citizenship': {
                name: 'Citizenship Application',
                showParents: true, showSpouse: true, showChildren: true, showSiblings: true,
                showEducation: true, showWork: true, showLanguage: true, showTravel: false,
                showCanadaEntry: true, showEmployer: false,
                showPRDetails: true, showAbsences: true, showCitizenshipDetails: true
            },
            'refugee_claim': {
                name: 'Refugee Claim (In-Canada)',
                showRefugeeForm: true, showPersonalInfo: true, showPassport: true,
                showCountries: true, showLanguage: true, showMaritalStatus: true,
                showChildren: true, showParents: true, showEducation: true,
                showWork: true, showBackgroundQuestions: true
            },
            'family_info': {
                name: 'Family Information (IMM 5645)',
                showFamilyInfoForm: true, showPersonalInfo: true
            },
            'client_profile': {
                name: 'Client Profile ‚Äî Information Record',
                showClientProfileForm: true, showPersonalInfo: true
            },
            'hc_application': {
                name: 'Humanitarian & Compassionate (H&C) Application',
                showHCForm: true, showPersonalInfo: true, showPassport: true,
                showMaritalStatus: true, showChildren: true, showParents: true,
                showHCEstablishment: true, showHCHardship: true, showHCBITC: true
            }
        };

        let idx = { child: 0, sibling: 0, work: 0, edu: 0, travel: 0, foreignExp: 0, canadianExp: 0, absence: 0, country: 0, prevAddress: 0, travelRoute: 0, otherTravelDoc: 0, refusalHistory: 0, refChild: 0, familyChild: 0, familySibling: 0, hcEmployment: 0, hcFamilyCanada: 0, hcSibling: 0, hcChild: 0, hcRefusal: 0 };

        // Sanitize input to prevent XSS
        function sanitizeInput(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function generateForm() {
            const type = document.getElementById('formType').value;
            const container = document.getElementById('formContent');
            const submitArea = document.getElementById('submitArea');
            
            if (!type) {
                container.innerHTML = `<div style="text-align:center; color:#64748b; padding:60px 40px;">
                    <div style="font-size:60px; margin-bottom:20px;">üëã</div>
                    <h3 style="margin-bottom:15px; font-size:24px; color:#334155;">Welcome to Waymark Immigration</h3>
                    <p>Please select an application type above to begin.</p>
                </div>`;
                submitArea.style.display = 'none';
                return;
            }

            const config = FORM_CONFIG[type] || {};
            idx = { child: 0, sibling: 0, work: 0, edu: 0, travel: 0, foreignExp: 0, canadianExp: 0, absence: 0, country: 0, prevAddress: 0, travelRoute: 0, otherTravelDoc: 0, refusalHistory: 0, refChild: 0, familyChild: 0, familySibling: 0, hcEmployment: 0, hcFamilyCanada: 0, hcSibling: 0, hcChild: 0, hcRefusal: 0 };

            let html = '';

            // PERSONAL INFORMATION
            html += `
            <div class="form-section theme-blue">
                <h2 class="section-title"><span class="icon">üë§</span> Personal Information</h2>
                <div class="row row-2">
                    <div><label>Given Name(s)</label><input type="text" name="givenName" placeholder="As shown on passport"></div>
                    <div><label>Family Name</label><input type="text" name="familyName" placeholder="As shown on passport"></div>
                </div>
                <div class="row row-3">
                    <div><label>Date of Birth</label><input type="date" name="dob"></div>
                    <div><label>Place of Birth</label><input type="text" name="pob" placeholder="City, Country"></div>
                    <div><label>Sex</label>
                        <select name="sex">
                            <option value="">Select</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
            </div>`;

            // PASSPORT
            html += `
            <div class="form-section theme-dark">
                <h2 class="section-title"><span class="icon">üõÇ</span> Passport / Travel Document</h2>
                <div class="row row-2">
                    <div><label>Passport Number</label><input type="text" name="passportNum" placeholder="e.g., A12345678"></div>
                    <div><label>Country of Citizenship</label><input type="text" name="citizenship" placeholder="e.g., India"></div>
                </div>
                <div class="row row-2">
                    <div><label>Issue Date</label><input type="date" name="passportIssue"></div>
                    <div><label>Expiry Date</label><input type="date" name="passportExpiry"></div>
                </div>
            </div>`;

            // COUNTRIES RESIDED 6+ MONTHS
            html += `
            <div class="form-section theme-green">
                <h2 class="section-title"><span class="icon">üåç</span> Countries of Residence</h2>
                <p style="font-size:14px; color:#64748b; margin-bottom:20px;">List all countries where you have lived for 6 months or more (other than your country of citizenship)</p>
                <div id="countryList"></div>
                <button type="button" class="btn btn-add" onclick="addCountry()" style="margin-top:15px;">+ Add Country</button>
            </div>`;

            // PR DETAILS
            if (config.showPRDetails) {
                html += `
                <div class="form-section theme-red">
                    <h2 class="section-title"><span class="icon">üçÅ</span> Permanent Residence Details</h2>
                    <div class="pr-box">
                        <h4>üé´ PR Card Information</h4>
                        <div class="row row-2">
                            <div><label>Date You Became PR</label><input type="date" name="prDate"></div>
                            <div><label>PR Card Number</label><input type="text" name="prCardNumber" placeholder="e.g., RA123456789"></div>
                        </div>
                        <div class="row row-2">
                            <div><label>PR Card Issue Date</label><input type="date" name="prCardIssue"></div>
                            <div><label>PR Card Expiry Date</label><input type="date" name="prCardExpiry"></div>
                        </div>
                    </div>
                    ${config.showCitizenshipDetails ? `
                    <div class="green-box">
                        <h4>üìä Physical Presence Calculation</h4>
                        <p style="font-size:13px; color:#64748b; margin-bottom:15px;">You must have been physically present in Canada for at least 1,095 days (3 years) during the 5 years before you apply.</p>
                        <div class="row row-2">
                            <div><label>Total Days in Canada (last 5 years)</label><input type="number" name="totalDaysInCanada" placeholder="e.g., 1200"></div>
                            <div><label>Have you filed taxes in Canada?</label>
                                <select name="filedTaxes">
                                    <option value="">Select</option>
                                    <option value="yes_all">Yes - All required years</option>
                                    <option value="yes_some">Yes - Some years</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    ` : ''}
                </div>`;
            }

            // MARITAL STATUS
            html += `
            <div class="form-section theme-purple">
                <h2 class="section-title"><span class="icon">üíç</span> Marital Status</h2>
                <div class="row">
                    <label>Current Marital Status</label>
                    <select name="maritalStatus" id="maritalStatus" onchange="toggleSpouse()">
                        <option value="">Select Status</option>
                        <option value="single">Single / Never Married</option>
                        <option value="married">Married</option>
                        <option value="common_law">Common-Law</option>
                        <option value="separated">Separated</option>
                        <option value="divorced">Divorced</option>
                        <option value="widowed">Widowed</option>
                    </select>
                </div>
                ${config.showSpouse ? `
                <div id="spouseSection" class="spouse-box" style="display:none; margin-top:20px;">
                    <h4>üíë Spouse / Partner Information</h4>
                    <div class="row row-2">
                        <div><label>Spouse Full Name</label><input type="text" name="spouseName" placeholder="Full legal name"></div>
                        <div><label>Date of Birth</label><input type="date" name="spouseDOB"></div>
                    </div>
                    <div class="row row-2">
                        <div><label>Date of Marriage/Union</label><input type="date" name="marriageDate"></div>
                        <div><label>Immigration Status</label>
                            <select name="spouseImmStatus">
                                <option value="">Select</option>
                                <option value="citizen">Canadian Citizen</option>
                                <option value="pr">Permanent Resident</option>
                                <option value="work">Work Permit</option>
                                <option value="study">Study Permit</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                </div>
                ` : ''}
                
                <!-- Previous Relationship -->
                <div class="spouse-box" style="margin-top:20px; background: linear-gradient(135deg, rgba(100, 116, 139, 0.08), rgba(100, 116, 139, 0.03)); border-color: rgba(100, 116, 139, 0.2);">
                    <h4 style="color: #475569;">üìã Previous Marriage / Common-Law</h4>
                    <div class="row">
                        <label>Have you previously been married or in a common-law relationship?</label>
                        <select name="hasPreviousRelationship" id="hasPreviousRelationship" onchange="togglePreviousRelationship()">
                            <option value="no">No</option>
                            <option value="yes">Yes</option>
                        </select>
                    </div>
                    <div id="previousRelationshipSection" class="conditional">
                        <div class="row row-2">
                            <div><label>Family Name</label><input type="text" name="prevPartnerFamilyName"></div>
                            <div><label>Given Name(s)</label><input type="text" name="prevPartnerGivenName"></div>
                        </div>
                        <div class="row row-3">
                            <div><label>Type</label>
                                <select name="prevRelationshipType"><option value="married">Married</option><option value="common_law">Common-Law</option></select>
                            </div>
                            <div><label>From</label><input type="date" name="prevRelationshipFrom"></div>
                            <div><label>To</label><input type="date" name="prevRelationshipTo"></div>
                        </div>
                    </div>
                </div>
            </div>`;

            // CONTACT
            html += `
            <div class="form-section theme-green">
                <h2 class="section-title"><span class="icon">üìß</span> Contact Information</h2>
                <div class="row row-2">
                    <div><label>Email</label><input type="email" name="email"></div>
                    <div><label>Phone</label><input type="tel" name="phone"></div>
                </div>
                <div class="row">
                    <label>Current Address</label>
                    <input type="text" name="address" placeholder="Street address">
                </div>
                <div class="row row-3">
                    <div><label>City</label><input type="text" name="city"></div>
                    <div><label>Province/State</label><input type="text" name="province"></div>
                    <div><label>Country</label><input type="text" name="country"></div>
                </div>
            </div>`;

            // CANADA ENTRY
            if (config.showCanadaEntry) {
                html += `
                <div class="form-section theme-orange">
                    <h2 class="section-title"><span class="icon">üõ¨</span> Entry to Canada</h2>
                    <div class="sub-title">1Ô∏è‚É£ First Entry to Canada</div>
                    <div class="row row-2">
                        <div><label>Date of First Entry</label><input type="date" name="firstEntryDate"></div>
                        <div><label>Place of Entry</label><input type="text" name="firstEntryPlace" placeholder="e.g., Toronto Pearson"></div>
                    </div>
                    <div class="row">
                        <label>Purpose</label>
                        <select name="firstEntryPurpose"><option value="">Select</option><option value="visitor">Visitor</option><option value="student">Student</option><option value="worker">Worker</option><option value="pr">Permanent Resident</option><option value="other">Other</option></select>
                    </div>
                    <div class="sub-title">‚úàÔ∏è Most Recent Entry to Canada <span style="font-weight:400; font-size:12px; color:#94a3b8;">(if different from first entry)</span></div>
                    <div class="row row-2">
                        <div><label>Date of Most Recent Entry</label><input type="date" name="recentEntryDate"></div>
                        <div><label>Place of Entry</label><input type="text" name="recentEntryPlace" placeholder="e.g., Vancouver International"></div>
                    </div>
                    <div class="row">
                        <label>Purpose</label>
                        <select name="recentEntryPurpose"><option value="">Select</option><option value="visitor">Visitor</option><option value="student">Student</option><option value="worker">Worker</option><option value="pr">Permanent Resident</option><option value="other">Other</option></select>
                    </div>
                    <div class="sub-title">2Ô∏è‚É£ Current Status</div>
                    <div class="row row-3">
                        <div><label>Current Immigration Status</label>
                            <select name="currentStatus"><option value="">Select</option><option value="visitor">Visitor</option><option value="student">Study Permit</option><option value="worker">Work Permit</option><option value="pr">Permanent Resident</option><option value="citizen">Citizen</option></select>
                        </div>
                        <div><label>Status From Date</label><input type="date" name="statusFromDate"></div>
                        <div><label>Status Expiry Date</label><input type="date" name="statusExpiry"></div>
                    </div>
                </div>`;
            }

            // SPOUSAL OWP DETAILS
            if (config.showSpousalOWP) {
                html += `
                <div class="form-section" style="border-left-color: #db2777;">
                    <h2 class="section-title"><span class="icon">üíï</span> Spousal OWP ‚Äî Sponsorship Details</h2>
                    <p style="font-size:14px; color:#64748b; margin-bottom:20px;">Provide details about the PR sponsorship application submitted by your spouse/partner</p>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <h4 style="font-weight:700; margin-bottom:15px;">üìã Sponsorship Application Info</h4>
                        <div class="row row-2">
                            <div><label>Sponsor's UCI Number</label><input type="text" name="sponsorUCI" placeholder="e.g., 1234-5678"></div>
                            <div><label>Sponsorship Application Number</label><input type="text" name="sponsorAppNumber" placeholder="e.g., B000123456"></div>
                        </div>
                        <div class="row row-2">
                            <div><label>Date Sponsorship Application Submitted</label><input type="date" name="sponsorAppDate"></div>
                            <div><label>Received Acknowledgement of Receipt (AOR)?</label>
                                <select name="receivedAOR">
                                    <option value="">Select</option>
                                    <option value="yes">Yes</option>
                                    <option value="no">No ‚Äî Not yet received</option>
                                </select>
                            </div>
                        </div>
                        <div class="row row-2">
                            <div><label>AOR Date (if received)</label><input type="date" name="aorDate"></div>
                            <div><label>Sponsorship Category</label>
                                <select name="sponsorCategory">
                                    <option value="">Select</option>
                                    <option value="spouse">Spouse</option>
                                    <option value="common_law">Common-Law Partner</option>
                                    <option value="conjugal">Conjugal Partner</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <h4 style="font-weight:700; margin-bottom:15px;">üìë Your Current Status in Canada</h4>
                        <div class="row row-2">
                            <div><label>Are you currently living with your sponsor in Canada?</label>
                                <select name="livingWithSponsor">
                                    <option value="">Select</option>
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                            <div><label>Do you currently have valid status in Canada?</label>
                                <select name="hasValidStatus">
                                    <option value="">Select</option>
                                    <option value="yes">Yes ‚Äî Valid status</option>
                                    <option value="implied">Implied Status (applied for extension)</option>
                                    <option value="no">No ‚Äî Out of status</option>
                                </select>
                            </div>
                        </div>
                        <div class="row row-2">
                            <div><label>Have you applied for Inland Spousal Sponsorship?</label>
                                <select name="inlandSponsorship">
                                    <option value="">Select</option>
                                    <option value="yes">Yes</option>
                                    <option value="no">No ‚Äî Outland</option>
                                </select>
                            </div>
                            <div><label>Have you had a previous OWP under this sponsorship?</label>
                                <select name="previousOWP">
                                    <option value="">Select</option>
                                    <option value="yes">Yes ‚Äî Renewal</option>
                                    <option value="no">No ‚Äî First time</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>`;
            }

            // EMPLOYER
            if (config.showEmployer) {
                html += `
                <div class="form-section theme-blue">
                    <h2 class="section-title"><span class="icon">üè¢</span> Employer Information</h2>
                    <div class="row row-2">
                        <div><label>Employer Name</label><input type="text" name="employerName"></div>
                        <div><label>Job Title</label><input type="text" name="jobTitle"></div>
                    </div>
                    <div class="row"><label>Address</label><input type="text" name="employerAddress"></div>
                    <div class="row row-3">
                        <div><label>LMIA Number</label><input type="text" name="lmiaNum"></div>
                        <div><label>NOC Code</label><input type="text" name="nocCode"></div>
                        <div><label>Wage (CAD/hr)</label><input type="text" name="wage"></div>
                    </div>
                </div>`;
            }

            // EDUCATION
            if (config.showEducation) {
                html += `
                <div class="form-section theme-blue">
                    <div class="dynamic-header"><h2 class="section-title" style="margin:0;"><span class="icon">üéì</span> Post Secondary Education</h2><button type="button" class="btn btn-add" onclick="addEducation()">+ Add</button></div>
                    <p style="font-size:14px; color:#64748b; margin:10px 0 20px 0;">Do you have any post secondary education? (Degree/Diploma/Certificate after Grade 12?)</p>
                    ${config.isExpressEntry ? `
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:20px; border:2px solid #e2e8f0;">
                        <h4 style="font-weight:700; margin-bottom:15px;">üìä For CRS Scoring</h4>
                        <div class="row row-2">
                            <div><label>Highest Level of Education</label>
                                <select name="highestEduLevel">
                                    <option value="">Select</option>
                                    <option value="none">Less than Secondary (High School)</option>
                                    <option value="secondary">Secondary (High School)</option>
                                    <option value="one_year">One-year post-secondary</option>
                                    <option value="two_year">Two-year post-secondary</option>
                                    <option value="bachelors">Bachelor's Degree (3+ year)</option>
                                    <option value="two_or_more">Two or more post-secondary credentials</option>
                                    <option value="masters">Master's Degree</option>
                                    <option value="phd">Doctoral (PhD)</option>
                                </select>
                            </div>
                            <div><label>Was education in Canada?</label>
                                <select name="eduInCanada"><option value="no">No</option><option value="yes_1_2">Yes (1-2 year credential)</option><option value="yes_3">Yes (3+ year credential)</option></select>
                            </div>
                        </div>
                        <div class="row row-2">
                            <div><label>Have you completed an ECA (Educational Credential Assessment)?</label>
                                <select name="hasECA"><option value="">Select</option><option value="yes">Yes</option><option value="no">No</option><option value="in_progress">In Progress</option></select>
                            </div>
                            <div><label>ECA Report Number</label><input type="text" name="ecaReportNumber" placeholder="e.g., WES 1234567"></div>
                        </div>
                    </div>
                    ` : ''}
                    <div id="educationList" style="margin-top:20px;"></div>
                </div>`;
            }

            // WORK
            if (config.showWork && !config.showForeignExp) {
                html += `
                <div class="form-section theme-purple">
                    <div class="dynamic-header"><h2 class="section-title" style="margin:0;"><span class="icon">üíº</span> Work Experience</h2><button type="button" class="btn btn-add" onclick="addWork()">+ Add Job</button></div>
                    <div id="workList" style="margin-top:20px;"></div>
                </div>`;
            }

            // FOREIGN WORK EXPERIENCE (Express Entry)
            if (config.showForeignExp) {
                html += `
                <div class="form-section theme-purple">
                    <div class="dynamic-header"><h2 class="section-title" style="margin:0;"><span class="icon">üåç</span> Foreign Work Experience</h2><button type="button" class="btn btn-add" onclick="addForeignExp()">+ Add Job</button></div>
                    <p style="font-size:14px; color:#64748b; margin:10px 0 20px 0;">Work experience outside Canada (minimum 1 year continuous full-time or equivalent part-time)</p>
                    <div id="foreignExpList" style="margin-top:20px;"></div>
                </div>`;
            }

            // CANADIAN WORK EXPERIENCE (Express Entry)
            if (config.showCanadianExp) {
                html += `
                <div class="form-section theme-purple">
                    <div class="dynamic-header"><h2 class="section-title" style="margin:0;"><span class="icon">üá®üá¶</span> Canadian Work Experience</h2><button type="button" class="btn btn-add" onclick="addCanadianExp()">+ Add Job</button></div>
                    <p style="font-size:14px; color:#64748b; margin:10px 0 20px 0;">Work experience in Canada with valid work authorization (minimum 1 year continuous)</p>
                    <div id="canadianExpList" style="margin-top:20px;"></div>
                </div>`;
            }

            // LANGUAGE
            if (config.showLanguage) {
                html += `
                <div class="form-section" style="border-left-color: var(--color-cyan);">
                    <h2 class="section-title"><span class="icon">üí¨</span> Language Ability</h2>
                    <div class="sub-title">üá¨üáß English</div>
                    <div class="row row-2">
                        <div><label>Test Type</label><select name="englishTest"><option value="">Select</option><option value="ielts">IELTS</option><option value="celpip">CELPIP</option><option value="pte">PTE</option><option value="none">None</option></select></div>
                        <div><label>Test Date</label><input type="date" name="englishTestDate"></div>
                    </div>
                    <p style="font-size:13px; color:#64748b; margin:10px 0;">Scores:</p>
                    <div class="score-grid">
                        <div class="score-item"><label>L</label><input type="text" name="engL" placeholder="0.0"></div>
                        <div class="score-item"><label>R</label><input type="text" name="engR" placeholder="0.0"></div>
                        <div class="score-item"><label>W</label><input type="text" name="engW" placeholder="0.0"></div>
                        <div class="score-item"><label>S</label><input type="text" name="engS" placeholder="0.0"></div>
                    </div>
                    <div class="sub-title" style="margin-top:25px;">üá´üá∑ French <span style="font-weight:400; font-size:12px; color:#94a3b8;">(Optional ‚Äî bilingual bonus for Express Entry)</span></div>
                    <div class="row row-2">
                        <div><label>Test Type</label><select name="frenchTest"><option value="">Select</option><option value="tef">TEF Canada</option><option value="tcf">TCF Canada</option><option value="none">None</option></select></div>
                        <div><label>Test Date</label><input type="date" name="frenchTestDate"></div>
                    </div>
                    <p style="font-size:13px; color:#64748b; margin:10px 0;">Scores:</p>
                    <div class="score-grid">
                        <div class="score-item"><label>L</label><input type="text" name="frL" placeholder="0.0"></div>
                        <div class="score-item"><label>R</label><input type="text" name="frR" placeholder="0.0"></div>
                        <div class="score-item"><label>W</label><input type="text" name="frW" placeholder="0.0"></div>
                        <div class="score-item"><label>S</label><input type="text" name="frS" placeholder="0.0"></div>
                    </div>
                </div>`;
            }

            // PARENTS
            if (config.showParents) {
                html += `
                <div class="form-section theme-orange">
                    <h2 class="section-title"><span class="icon">üë®‚Äçüë©‚Äçüë¶</span> Parents' Information</h2>
                    <div class="parent-box" style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <h4 style="font-size:17px; font-weight:800; color:var(--color-orange); margin-bottom:18px;">üë® Father</h4>
                        <div class="row row-2">
                            <div><label>Full Name</label><input type="text" name="fatherName" placeholder="Full legal name"></div>
                            <div><label>Date of Birth</label><input type="date" name="fatherDOB"></div>
                        </div>
                        <div class="row row-2">
                            <div><label>Country of Birth</label><input type="text" name="fatherBirthCountry"></div>
                            <div><label>Current Country of Residence</label><input type="text" name="fatherResidence"></div>
                        </div>
                        <div class="row row-2">
                            <div><label>Citizenship</label><input type="text" name="fatherCitizenship"></div>
                            <div><label>Immigration Status (if in Canada)</label>
                                <select name="fatherImmStatus">
                                    <option value="">N/A</option>
                                    <option value="citizen">Canadian Citizen</option>
                                    <option value="pr">Permanent Resident</option>
                                    <option value="temporary">Temporary Resident</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="row"><label>Occupation</label><input type="text" name="fatherOccupation"></div>
                        <div class="row"><label>Is your father deceased?</label>
                            <select name="fatherDeceased"><option value="no">No</option><option value="yes">Yes</option></select>
                        </div>
                    </div>
                    <div class="parent-box" style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <h4 style="font-size:17px; font-weight:800; color:var(--color-orange); margin-bottom:18px;">üë© Mother</h4>
                        <div class="row row-2">
                            <div><label>Full Name</label><input type="text" name="motherName" placeholder="Full legal name"></div>
                            <div><label>Date of Birth</label><input type="date" name="motherDOB"></div>
                        </div>
                        <div class="row row-2">
                            <div><label>Country of Birth</label><input type="text" name="motherBirthCountry"></div>
                            <div><label>Current Country of Residence</label><input type="text" name="motherResidence"></div>
                        </div>
                        <div class="row row-2">
                            <div><label>Citizenship</label><input type="text" name="motherCitizenship"></div>
                            <div><label>Immigration Status (if in Canada)</label>
                                <select name="motherImmStatus">
                                    <option value="">N/A</option>
                                    <option value="citizen">Canadian Citizen</option>
                                    <option value="pr">Permanent Resident</option>
                                    <option value="temporary">Temporary Resident</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="row"><label>Occupation</label><input type="text" name="motherOccupation"></div>
                        <div class="row"><label>Is your mother deceased?</label>
                            <select name="motherDeceased"><option value="no">No</option><option value="yes">Yes</option></select>
                        </div>
                    </div>
                </div>`;
            }

            // CHILDREN / DEPENDENTS
            if (config.showChildren) {
                html += `
                <div class="form-section theme-green">
                    <div class="dynamic-header"><h2 class="section-title" style="margin:0;"><span class="icon">üë∂</span> Children / Dependents</h2><button type="button" class="btn btn-add" onclick="addChild()">+ Add Child</button></div>
                    <p style="font-size:14px; color:#64748b; margin:10px 0 20px 0;">List all dependent children (under 22, or 22+ if dependent due to condition)</p>
                    <div class="row">
                        <label>Do you have any dependent children?</label>
                        <select name="hasChildren" id="hasChildren" onchange="document.getElementById('childrenList').style.display = this.value === 'yes' ? 'block' : 'none'">
                            <option value="no">No</option>
                            <option value="yes">Yes</option>
                        </select>
                    </div>
                    <div id="childrenList" style="margin-top:20px; display:none;"></div>
                </div>`;
            }

            // SIBLINGS
            if (config.showSiblings) {
                html += `
                <div class="form-section theme-blue">
                    <div class="dynamic-header"><h2 class="section-title" style="margin:0;"><span class="icon">üë´</span> Siblings</h2><button type="button" class="btn btn-add" onclick="addSibling()">+ Add Sibling</button></div>
                    <p style="font-size:14px; color:#64748b; margin:10px 0 20px 0;">List all brothers and sisters</p>
                    <div class="row">
                        <label>Do you have any siblings?</label>
                        <select name="hasSiblings" id="hasSiblings" onchange="document.getElementById('siblingsList').style.display = this.value === 'yes' ? 'block' : 'none'">
                            <option value="no">No</option>
                            <option value="yes">Yes</option>
                        </select>
                    </div>
                    <div id="siblingsList" style="margin-top:20px; display:none;"></div>
                </div>`;
            }

            // BLOOD RELATION IN CANADA (Express Entry)
            if (config.showBloodRelation) {
                html += `
                <div class="form-section" style="border-left-color: #db2777;">
                    <h2 class="section-title"><span class="icon">ü©∏</span> Blood Relative in Canada</h2>
                    <p style="font-size:14px; color:#64748b; margin-bottom:15px;">Do you or your spouse/partner have a blood relative who is a Canadian citizen or permanent resident living in Canada? (Sibling, parent, grandparent, aunt/uncle, niece/nephew)</p>
                    <div class="row">
                        <select name="hasBloodRelation" id="hasBloodRelation" onchange="document.getElementById('bloodRelationDetails').style.display = this.value === 'yes' ? 'block' : 'none'">
                            <option value="no">No</option>
                            <option value="yes">Yes</option>
                        </select>
                    </div>
                    <div id="bloodRelationDetails" style="display:none; margin-top:15px;">
                        <div class="row row-2">
                            <div><label>Relative's Name</label><input type="text" name="bloodRelName"></div>
                            <div><label>Relationship</label>
                                <select name="bloodRelRelationship">
                                    <option value="">Select</option>
                                    <option value="parent">Parent</option>
                                    <option value="sibling">Sibling</option>
                                    <option value="grandparent">Grandparent</option>
                                    <option value="aunt_uncle">Aunt/Uncle</option>
                                    <option value="niece_nephew">Niece/Nephew</option>
                                    <option value="child">Child</option>
                                </select>
                            </div>
                        </div>
                        <div class="row row-2">
                            <div><label>Their Immigration Status</label>
                                <select name="bloodRelStatus">
                                    <option value="">Select</option>
                                    <option value="citizen">Canadian Citizen</option>
                                    <option value="pr">Permanent Resident</option>
                                </select>
                            </div>
                            <div><label>City / Province</label><input type="text" name="bloodRelLocation" placeholder="e.g., Toronto, ON"></div>
                        </div>
                        <div class="row">
                            <label>Is this your relative or your spouse's relative?</label>
                            <select name="bloodRelWhose">
                                <option value="">Select</option>
                                <option value="mine">Mine</option>
                                <option value="spouse">My Spouse's/Partner's</option>
                            </select>
                        </div>
                    </div>
                </div>`;
            }

            // SPOUSE DETAILS FOR CRS (Express Entry)
            if (config.showSpouseDetails) {
                html += `
                <div class="form-section theme-purple" id="spouseDetailsSection" style="display:none;">
                    <h2 class="section-title"><span class="icon">üíë</span> Spouse/Partner Details for CRS</h2>
                    <p style="font-size:14px; color:#64748b; margin-bottom:20px;">If your spouse/partner is accompanying you to Canada, their details affect your CRS score</p>
                    <div class="row">
                        <label>Will your spouse/partner accompany you to Canada?</label>
                        <select name="spouseAccompanying" id="spouseAccompanying" onchange="document.getElementById('spouseCRSFields').style.display = this.value === 'yes' ? 'block' : 'none'">
                            <option value="">Select</option>
                            <option value="yes">Yes</option>
                            <option value="no">No</option>
                        </select>
                    </div>
                    <div id="spouseCRSFields" style="display:none; margin-top:15px;">
                        <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                            <h4 style="font-weight:700; margin-bottom:15px;">üéì Spouse's Education</h4>
                            <div class="row row-2">
                                <div><label>Highest Level of Education</label>
                                    <select name="spouseEduLevel">
                                        <option value="">Select</option>
                                        <option value="secondary">Secondary (High School)</option>
                                        <option value="one_year">One-year post-secondary</option>
                                        <option value="two_year">Two-year post-secondary</option>
                                        <option value="three_year">Three+ year post-secondary</option>
                                        <option value="masters">Master's Degree</option>
                                        <option value="phd">Doctoral (PhD)</option>
                                    </select>
                                </div>
                                <div><label>Was education in Canada?</label>
                                    <select name="spouseEduCanada">
                                        <option value="no">No</option>
                                        <option value="yes">Yes</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row"><label>Has your spouse completed an ECA (Educational Credential Assessment)?</label>
                                <select name="spouseECA"><option value="no">No</option><option value="yes">Yes</option></select>
                            </div>
                        </div>
                        <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                            <h4 style="font-weight:700; margin-bottom:15px;">üí¨ Spouse's Language Scores</h4>
                            <div class="row row-2">
                                <div><label>English Test Type</label>
                                    <select name="spouseEngTest"><option value="">Select</option><option value="ielts">IELTS</option><option value="celpip">CELPIP</option><option value="pte">PTE</option><option value="none">None</option></select>
                                </div>
                                <div><label>Test Date</label><input type="date" name="spouseEngTestDate"></div>
                            </div>
                            <p style="font-size:13px; color:#64748b; margin:10px 0;">Scores:</p>
                            <div class="score-grid">
                                <div class="score-item"><label>L</label><input type="text" name="spouseEngL" placeholder="0.0"></div>
                                <div class="score-item"><label>R</label><input type="text" name="spouseEngR" placeholder="0.0"></div>
                                <div class="score-item"><label>W</label><input type="text" name="spouseEngW" placeholder="0.0"></div>
                                <div class="score-item"><label>S</label><input type="text" name="spouseEngS" placeholder="0.0"></div>
                            </div>
                            <div class="row row-2" style="margin-top:15px;">
                                <div><label>French Test Type</label>
                                    <select name="spouseFrTest"><option value="">Select</option><option value="tef">TEF</option><option value="tcf">TCF</option><option value="none">None</option></select>
                                </div>
                                <div><label>Test Date</label><input type="date" name="spouseFrTestDate"></div>
                            </div>
                            <div class="score-grid" style="margin-top:10px;">
                                <div class="score-item"><label>L</label><input type="text" name="spouseFrL" placeholder="0.0"></div>
                                <div class="score-item"><label>R</label><input type="text" name="spouseFrR" placeholder="0.0"></div>
                                <div class="score-item"><label>W</label><input type="text" name="spouseFrW" placeholder="0.0"></div>
                                <div class="score-item"><label>S</label><input type="text" name="spouseFrS" placeholder="0.0"></div>
                            </div>
                        </div>
                        <div style="background:white; padding:20px; border-radius:14px; border:2px solid #e2e8f0;">
                            <h4 style="font-weight:700; margin-bottom:15px;">üíº Spouse's Canadian Work Experience</h4>
                            <div class="row">
                                <label>Years of Canadian work experience</label>
                                <select name="spouseCanadianWorkYears">
                                    <option value="0">None</option>
                                    <option value="1">1 year</option>
                                    <option value="2">2 years</option>
                                    <option value="3">3 years</option>
                                    <option value="4">4 years</option>
                                    <option value="5">5+ years</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>`;
            }

            // ABSENCES FROM CANADA (PR Renewal / Citizenship)
            if (config.showAbsences) {
                html += `
                <div class="form-section theme-red">
                    <div class="dynamic-header"><h2 class="section-title" style="margin:0;"><span class="icon">‚úàÔ∏è</span> Absences from Canada</h2><button type="button" class="btn btn-add" onclick="addAbsence()">+ Add Absence</button></div>
                    <p style="font-size:14px; color:#64748b; margin:10px 0 20px 0;">${config.showCitizenshipDetails ? 'List all trips outside Canada in the last 5 years. You must have been physically present in Canada for at least 1,095 days.' : 'List all absences from Canada during the last 5 years. You must meet the residency obligation (730 days in the past 5 years).'}</p>
                    <div id="absenceList" style="margin-top:20px;"></div>
                </div>`;
            }

            // TRAVEL HISTORY
            if (config.showTravel) {
                html += `
                <div class="form-section theme-dark">
                    <div class="dynamic-header"><h2 class="section-title" style="margin:0;"><span class="icon">üåé</span> Travel History</h2><button type="button" class="btn btn-add" onclick="addTravel()">+ Add Trip</button></div>
                    <p style="font-size:14px; color:#64748b; margin:10px 0 20px 0;">List all international travel in the last 10 years (other than your country of residence)</p>
                    <div id="travelList" style="margin-top:20px;"></div>
                </div>`;
            }

            // BACKGROUND
            html += `
            <div class="form-section theme-red">
                <h2 class="section-title"><span class="icon">üìã</span> Background Questions</h2>
                ${bgQuestion('bg_criminal', 'Have you ever been convicted of a criminal offence?')}
                ${bgQuestion('bg_refusal', 'Have you been refused a visa or had immigration issues?')}
                ${bgQuestion('bg_health', 'Do you have any serious health conditions?')}
            </div>`;

            // ADDITIONAL
            html += `
            <div class="form-section theme-dark">
                <h2 class="section-title"><span class="icon">üìù</span> Additional Information</h2>
                <div class="row"><label>Anything else?</label><textarea name="additionalInfo" rows="4"></textarea></div>
                <div class="row"><label>How did you hear about us?</label>
                    <select name="referral"><option value="">Select</option><option value="google">Google</option><option value="social">Social Media</option><option value="friend">Friend/Family</option><option value="returning">Returning Client</option><option value="other">Other</option></select>
                </div>
            </div>`;

            // REFUGEE CLAIM FORM
            if (config.showRefugeeForm) {
                html = `
                <div class="form-section theme-blue">
                    <h2 class="section-title"><span class="icon">üõ°Ô∏è</span> Existing Refugee Claim</h2>
                    <div class="row"><label>Have you already made a refugee claim in Canada?</label>
                        <select name="ref_existing_claim" id="ref_existing_claim" onchange="document.getElementById('ref_existing_details').style.display = this.value === 'yes' ? 'block' : 'none'">
                            <option value="no">No</option><option value="yes">Yes</option>
                        </select>
                    </div>
                    <div id="ref_existing_details" style="display:none; margin-top:15px;">
                        <div class="row"><label>Application Number</label><input type="text" name="ref_claim_number"></div>
                    </div>
                </div>
                <div class="form-section theme-blue">
                    <h2 class="section-title"><span class="icon">üë§</span> Personal Information</h2>
                    <div class="row row-2">
                        <div><label>Full Name (as on passport)</label><input type="text" name="givenName" placeholder="Given names"></div>
                        <div><label>Family Name</label><input type="text" name="familyName"></div>
                    </div>
                    <div class="row row-2"><div><label>Date of Birth</label><input type="date" name="dob"></div><div><label>Sex</label>
                        <select name="sex"><option value="">Select</option><option value="male">Male</option><option value="female">Female</option><option value="other">Other</option></select>
                    </div></div>
                    <div class="row row-2"><div><label>Height (cm)</label><input type="text" name="ref_height"></div><div><label>Eye Color</label><input type="text" name="ref_eye_color"></div></div>
                    <div class="row"><label>Have you used another name in the past?</label>
                        <select name="ref_other_names" id="ref_other_names" onchange="document.getElementById('ref_other_names_detail').style.display = this.value === 'yes' ? 'block' : 'none'">
                            <option value="no">No</option><option value="yes">Yes</option>
                        </select>
                    </div>
                    <div id="ref_other_names_detail" style="display:none; margin-top:15px;">
                        <label>What name?</label><input type="text" name="ref_other_names_text">
                    </div>
                </div>
                <div class="form-section theme-green">
                    <h2 class="section-title"><span class="icon">üìß</span> Contact Information</h2>
                    <div class="row row-2"><div><label>Email</label><input type="email" name="email"></div><div><label>Phone</label><input type="tel" name="phone"></div></div>
                    <div class="row"><label>Current Address</label><input type="text" name="address" placeholder="Street"></div>
                    <div class="row row-3"><div><label>City</label><input type="text" name="city"></div><div><label>Province</label><input type="text" name="province"></div><div><label>Postal Code</label><input type="text" name="postalCode"></div></div>
                    <div class="row"><label>Country</label><input type="text" name="country"></div>
                    <div class="row"><label>Date began living at this address</label><input type="date" name="ref_address_date"></div>
                    <div class="row"><label>Is this your mailing address?</label>
                        <select name="ref_is_mailing" id="ref_is_mailing" onchange="document.getElementById('ref_mailing_address').style.display = this.value === 'no' ? 'block' : 'none'">
                            <option value="yes">Yes</option><option value="no">No</option>
                        </select>
                    </div>
                    <div id="ref_mailing_address" style="display:none; margin-top:15px;">
                        <div class="row"><label>Mailing Address</label><input type="text" name="ref_mailing_street"></div>
                        <div class="row row-3"><div><label>City</label><input type="text" name="ref_mailing_city"></div><div><label>Province</label><input type="text" name="ref_mailing_province"></div><div><label>Postal Code</label><input type="text" name="ref_mailing_postal"></div></div>
                    </div>
                </div>
                <div class="form-section theme-dark">
                    <div class="dynamic-header"><h2 class="section-title" style="margin:0;"><span class="icon">üè†</span> Previous Address History (Last 10 Years)</h2><button type="button" class="btn btn-add" onclick="addPreviousAddress()">+ Add Address</button></div>
                    <div id="prevAddressList" style="margin-top:20px;"></div>
                </div>
                <div class="form-section" style="border-left-color: var(--color-cyan);">
                    <h2 class="section-title"><span class="icon">üí¨</span> Languages</h2>
                    <div class="row"><label>Native language / Mother tongue</label><input type="text" name="ref_native_lang" placeholder="Required"></div>
                    <div class="row row-2"><div><label>Other languages spoken (1)</label><input type="text" name="ref_other_lang_1"></div><div><label>Other languages spoken (2)</label><input type="text" name="ref_other_lang_2"></div></div>
                    <div class="row row-2"><div><label>Language for interview</label><input type="text" name="ref_interview_lang"></div><div><label>Language for contact</label><input type="text" name="ref_contact_lang"></div></div>
                </div>
                <div class="form-section theme-dark">
                    <h2 class="section-title"><span class="icon">üõÇ</span> Passport / Travel Document</h2>
                    <div class="row"><label>Have you ever had a passport?</label>
                        <select name="ref_has_passport" id="ref_has_passport" onchange="document.getElementById('ref_passport_details').style.display = this.value === 'yes' ? 'block' : 'none'">
                            <option value="no">No</option><option value="yes">Yes</option>
                        </select>
                    </div>
                    <div id="ref_passport_details" style="display:none; margin-top:15px;">
                        <div class="row row-2"><div><label>Kind of Passport</label><select name="ref_passport_type"><option value="regular">Regular</option><option value="diplomatic">Diplomatic</option><option value="official">Official</option><option value="service">Service</option></select></div><div><label>Place Issued</label><input type="text" name="ref_passport_place"></div></div>
                        <div class="row row-2"><div><label>Nationality on Passport</label><input type="text" name="ref_passport_nationality"></div><div><label>Passport Number</label><input type="text" name="passportNum"></div></div>
                        <div class="row row-2"><div><label>Issue Date</label><input type="date" name="passportIssue"></div><div><label>Expiry Date</label><input type="date" name="passportExpiry"></div></div>
                        <div class="row"><label>Where is the original copy?</label><input type="text" name="ref_passport_location"></div>
                    </div>
                </div>
                <div class="form-section theme-purple">
                    <h2 class="section-title"><span class="icon">üíç</span> Marital Status & Family</h2>
                    <div class="row"><label>Current Marital Status</label>
                        <select name="maritalStatus" id="maritalStatus" onchange="document.getElementById('ref_spouse_section').style.display = ['married', 'common_law'].includes(this.value) ? 'block' : 'none'">
                            <option value="single">Single</option><option value="married">Married</option><option value="common_law">Common-Law</option><option value="separated">Separated</option><option value="divorced">Divorced</option><option value="widowed">Widowed</option><option value="annulled">Annulled Marriage</option>
                        </select>
                    </div>
                    <div id="ref_spouse_section" style="display:none; margin-top:20px;">
                        <div class="spouse-box">
                            <h4>Spouse / Partner Information</h4>
                            <div class="row row-2"><div><label>Date Marriage/Common-law Began</label><input type="date" name="ref_spouse_date"></div><div><label>Full Name</label><input type="text" name="spouseName"></div></div>
                            <div class="row row-2"><div><label>Date of Birth</label><input type="date" name="spouseDOB"></div><div><label>Country of Birth</label><input type="text" name="ref_spouse_birthcountry"></div></div>
                            <div class="row row-2"><div><label>Current Occupation</label><input type="text" name="ref_spouse_occupation"></div><div><label>Do they live with you?</label><select name="ref_spouse_living"><option value="yes">Yes</option><option value="no">No</option></select></div></div>
                        </div>
                    </div>
                </div>
                <div class="form-section theme-green">
                    <div class="dynamic-header"><h2 class="section-title" style="margin:0;"><span class="icon">üë∂</span> Children</h2><button type="button" class="btn btn-add" onclick="addRefugeeChild()">+ Add Child</button></div>
                    <div id="refChildrenList" style="margin-top:20px;"></div>
                </div>
                <div class="form-section theme-orange">
                    <h2 class="section-title"><span class="icon">üë®‚Äçüë©</span> Parents</h2>
                    <div class="parent-box">
                        <h4>Mother</h4>
                        <div class="row row-2"><div><label>Full Name</label><input type="text" name="motherName"></div><div><label>Date of Birth</label><input type="date" name="motherDOB"></div></div>
                        <div class="row row-2"><div><label>Country of Birth</label><input type="text" name="motherBirthCountry"></div><div><label>Citizenship</label><input type="text" name="motherCitizenship"></div></div>
                        <div class="row"><label>Same address as you?</label><select name="ref_mother_same_address" onchange="document.getElementById('ref_mother_address').style.display = this.value === 'no' ? 'block' : 'none'"><option value="yes">Yes</option><option value="no">No</option></select></div>
                        <div id="ref_mother_address" style="display:none; margin-top:10px;"><label>Full Address</label><input type="text" name="ref_mother_address_text"></div>
                        <div class="row"><label>Is your mother deceased?</label><select name="ref_mother_deceased" id="ref_mother_deceased" onchange="document.getElementById('ref_mother_death_date').style.display = this.value === 'yes' ? 'block' : 'none'"><option value="no">No</option><option value="yes">Yes</option></select></div>
                        <div id="ref_mother_death_date" style="display:none; margin-top:10px;"><label>Date of Death</label><input type="date" name="ref_mother_death_date_val"></div>
                    </div>
                    <div class="parent-box">
                        <h4>Father</h4>
                        <div class="row row-2"><div><label>Full Name</label><input type="text" name="fatherName"></div><div><label>Date of Birth</label><input type="date" name="fatherDOB"></div></div>
                        <div class="row row-2"><div><label>Country of Birth</label><input type="text" name="fatherBirthCountry"></div><div><label>Citizenship</label><input type="text" name="fatherCitizenship"></div></div>
                        <div class="row"><label>Same address as you?</label><select name="ref_father_same_address" onchange="document.getElementById('ref_father_address').style.display = this.value === 'no' ? 'block' : 'none'"><option value="yes">Yes</option><option value="no">No</option></select></div>
                        <div id="ref_father_address" style="display:none; margin-top:10px;"><label>Full Address</label><input type="text" name="ref_father_address_text"></div>
                        <div class="row"><label>Is your father deceased?</label><select name="ref_father_deceased" id="ref_father_deceased" onchange="document.getElementById('ref_father_death_date').style.display = this.value === 'yes' ? 'block' : 'none'"><option value="no">No</option><option value="yes">Yes</option></select></div>
                        <div id="ref_father_death_date" style="display:none; margin-top:10px;"><label>Date of Death</label><input type="date" name="ref_father_death_date_val"></div>
                    </div>
                </div>
                <div class="form-section theme-blue">
                    <h2 class="section-title"><span class="icon">üë®‚Äç‚öñÔ∏è</span> Guardian Information</h2>
                    <div class="row"><label>Do you have a guardian? (Required if under 18 or cannot understand proceedings)</label>
                        <select name="ref_has_guardian" id="ref_has_guardian" onchange="document.getElementById('ref_guardian_details').style.display = this.value === 'yes' ? 'block' : 'none'">
                            <option value="no">No</option><option value="yes">Yes</option>
                        </select>
                    </div>
                    <div id="ref_guardian_details" style="display:none; margin-top:15px;">
                        <div class="row"><label>Relationship to Guardian</label><input type="text" name="ref_guardian_relation"></div>
                        <div class="row"><label>Guardian's Full Name</label><input type="text" name="ref_guardian_name"></div>
                        <div class="row"><label>Guardian's Full Mailing Address</label><input type="text" name="ref_guardian_address"></div>
                    </div>
                </div>
                <div class="form-section theme-orange">
                    <h2 class="section-title"><span class="icon">‚úàÔ∏è</span> Travel to Canada</h2>
                    <div class="row"><label>How did you arrive?</label><select name="ref_arrival_method"><option value="">Select</option><option value="air">Air</option><option value="sea">Sea</option><option value="land">Land</option></select></div>
                    <div class="row row-2"><div><label>Were you a crew member?</label><select name="ref_crew_member"><option value="no">No</option><option value="yes">Yes</option></select></div><div><label>Were you a stowaway?</label><select name="ref_stowaway"><option value="no">No</option><option value="yes">Yes</option></select></div></div>
                    <div class="row row-2"><div><label>Where did you enter Canada?</label><input type="text" name="ref_entry_port" placeholder="Port name"></div><div><label>Immigration Status Document Number</label><input type="text" name="ref_imm_doc_number"></div></div>
                    <div class="row"><label>Ticket Number</label><input type="text" name="ref_ticket_number"></div>
                </div>
                <div class="form-section theme-blue">
                    <div class="dynamic-header"><h2 class="section-title" style="margin:0;"><span class="icon">üõ´</span> Travel Route to Canada</h2><button type="button" class="btn btn-add" onclick="addTravelRoute()">+ Add Route Segment</button></div>
                    <div id="travelRouteList" style="margin-top:20px;"></div>
                </div>
                <div class="form-section theme-blue">
                    <div class="dynamic-header"><h2 class="section-title" style="margin:0;"><span class="icon">üéì</span> Post-Secondary Education</h2><button type="button" class="btn btn-add" onclick="addEducation()">+ Add</button></div>
                    <div id="educationList" style="margin-top:20px;"></div>
                </div>
                <div class="form-section theme-purple">
                    <div class="dynamic-header"><h2 class="section-title" style="margin:0;"><span class="icon">üíº</span> Work & Activities History (Last 10 Years)</h2><button type="button" class="btn btn-add" onclick="addWork()">+ Add</button></div>
                    <div id="workList" style="margin-top:20px;"></div>
                </div>
                <div class="form-section theme-red">
                    <h2 class="section-title"><span class="icon">üìã</span> Background Questions</h2>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <p style="font-weight:700; margin-bottom:12px;">Have you ever held a government position?</p>
                        <select name="ref_gov_position" id="ref_gov_position" onchange="document.getElementById('ref_gov_position_detail').style.display = this.value === 'yes' ? 'block' : 'none'" style="width:100%; max-width:200px; padding:12px 16px; border:2px solid #e2e8f0; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer;">
                            <option value="no">No</option><option value="yes">Yes</option>
                        </select>
                        <div id="ref_gov_position_detail" style="display:none; margin-top:15px;"><label>Details:</label><textarea name="ref_gov_position_detail_text" rows="3"></textarea></div>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <p style="font-weight:700; margin-bottom:12px;">Did you serve in any military, militia, civil defence, security or police force?</p>
                        <select name="ref_military" id="ref_military" onchange="document.getElementById('ref_military_detail').style.display = this.value === 'yes' ? 'block' : 'none'" style="width:100%; max-width:200px; padding:12px 16px; border:2px solid #e2e8f0; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer;">
                            <option value="no">No</option><option value="yes">Yes</option>
                        </select>
                        <div id="ref_military_detail" style="display:none; margin-top:15px;"><label>Details:</label><textarea name="ref_military_detail_text" rows="3"></textarea></div>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <p style="font-weight:700; margin-bottom:12px;">Have you ever been convicted of a crime?</p>
                        <select name="ref_convicted" id="ref_convicted" onchange="document.getElementById('ref_convicted_detail').style.display = this.value === 'yes' ? 'block' : 'none'" style="width:100%; max-width:200px; padding:12px 16px; border:2px solid #e2e8f0; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer;">
                            <option value="no">No</option><option value="yes">Yes</option>
                        </select>
                        <div id="ref_convicted_detail" style="display:none; margin-top:15px;"><label>Details:</label><textarea name="ref_convicted_detail_text" rows="3"></textarea></div>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <p style="font-weight:700; margin-bottom:12px;">Are you afraid to return to your home country?</p>
                        <select name="ref_afraid_return" id="ref_afraid_return" onchange="document.getElementById('ref_afraid_return_detail').style.display = this.value === 'yes' ? 'block' : 'none'" style="width:100%; max-width:200px; padding:12px 16px; border:2px solid #e2e8f0; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer;">
                            <option value="no">No</option><option value="yes">Yes</option>
                        </select>
                        <div id="ref_afraid_return_detail" style="display:none; margin-top:15px;"><label>Country you are afraid to return to:</label><input type="text" name="ref_afraid_country"></div>
                    </div>
                </div>
                <div class="form-section theme-dark">
                    <h2 class="section-title"><span class="icon">üìù</span> Additional Information</h2>
                    <div class="row"><label>Anything else we should know?</label><textarea name="additionalInfo" rows="4"></textarea></div>
                </div>
                `;
                container.innerHTML = html;
                submitArea.style.display = 'block';
                addCountry();
                addEducation();
                addWork();
                addPreviousAddress();
                addTravelRoute();
                addRefugeeChild();
                return;
            }

            // FAMILY INFORMATION FORM (IMM 5645)
            if (config.showFamilyInfoForm) {
                html = `
                <div class="form-section theme-blue">
                    <h2 class="section-title"><span class="icon">üìã</span> Type of Application</h2>
                    <div class="row"><select name="imm_app_type"><option value="">Select</option><option value="visitor">Visitor</option><option value="worker">Worker</option><option value="student">Student</option><option value="other">Other</option></select></div>
                </div>
                <div class="form-section theme-purple">
                    <h2 class="section-title"><span class="icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span> Section A - Family Members</h2>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <h4 style="font-weight:700; margin-bottom:15px;">Applicant</h4>
                        <div class="row row-2"><div><label>Name</label><input type="text" name="imm_applicant_name" placeholder="Full legal name"></div><div><label>Date of Birth (YYYY-MM-DD)</label><input type="date" name="imm_applicant_dob"></div></div>
                        <div class="row row-2"><div><label>Country of Birth</label><input type="text" name="imm_applicant_cob"></div><div><label>Marital Status</label><input type="text" name="imm_applicant_marital"></div></div>
                        <div class="row"><label>Present Occupation</label><input type="text" name="imm_applicant_occupation"></div>
                        <div class="row"><label>Present Address (or if deceased: city/town, country, date)</label><input type="text" name="imm_applicant_address"></div>
                        <div class="row"><label>Will accompany you to Canada?</label><select name="imm_applicant_accompany"><option value="n/a">N/A (Self)</option><option value="yes">Yes</option><option value="no">No</option></select></div>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <h4 style="font-weight:700; margin-bottom:15px;">Spouse/Common-Law Partner</h4>
                        <div class="row row-2"><div><label>Name</label><input type="text" name="imm_spouse_name" placeholder="Full legal name"></div><div><label>Date of Birth (YYYY-MM-DD)</label><input type="date" name="imm_spouse_dob"></div></div>
                        <div class="row row-2"><div><label>Country of Birth</label><input type="text" name="imm_spouse_cob"></div><div><label>Marital Status</label><input type="text" name="imm_spouse_marital"></div></div>
                        <div class="row"><label>Present Occupation</label><input type="text" name="imm_spouse_occupation"></div>
                        <div class="row"><label>Present Address (or if deceased: city/town, country, date)</label><input type="text" name="imm_spouse_address"></div>
                        <div class="row"><label>Will accompany you to Canada?</label><select name="imm_spouse_accompany"><option value="yes">Yes</option><option value="no">No</option></select></div>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <h4 style="font-weight:700; margin-bottom:15px;">Mother</h4>
                        <div class="row row-2"><div><label>Name</label><input type="text" name="imm_mother_name"></div><div><label>Date of Birth (YYYY-MM-DD)</label><input type="date" name="imm_mother_dob"></div></div>
                        <div class="row row-2"><div><label>Country of Birth</label><input type="text" name="imm_mother_cob"></div><div><label>Marital Status</label><input type="text" name="imm_mother_marital"></div></div>
                        <div class="row"><label>Present Occupation</label><input type="text" name="imm_mother_occupation"></div>
                        <div class="row"><label>Present Address (or if deceased: city/town, country, date)</label><input type="text" name="imm_mother_address"></div>
                        <div class="row"><label>Will accompany you to Canada?</label><select name="imm_mother_accompany"><option value="yes">Yes</option><option value="no">No</option></select></div>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <h4 style="font-weight:700; margin-bottom:15px;">Father</h4>
                        <div class="row row-2"><div><label>Name</label><input type="text" name="imm_father_name"></div><div><label>Date of Birth (YYYY-MM-DD)</label><input type="date" name="imm_father_dob"></div></div>
                        <div class="row row-2"><div><label>Country of Birth</label><input type="text" name="imm_father_cob"></div><div><label>Marital Status</label><input type="text" name="imm_father_marital"></div></div>
                        <div class="row"><label>Present Occupation</label><input type="text" name="imm_father_occupation"></div>
                        <div class="row"><label>Present Address (or if deceased: city/town, country, date)</label><input type="text" name="imm_father_address"></div>
                        <div class="row"><label>Will accompany you to Canada?</label><select name="imm_father_accompany"><option value="yes">Yes</option><option value="no">No</option></select></div>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0; border-top: 3px dashed #cbd5e1;">
                        <p style="font-weight:700; font-size:13px; margin-bottom:10px;">Note: If no spouse listed, certification required</p>
                        <p style="font-size:13px; margin-bottom:10px;">I certify that I do not have a spouse or a common-law partner.</p>
                        <div class="row row-2"><div><label>Signature</label><input type="text" name="imm_no_spouse_sig"></div><div><label>Date</label><input type="date" name="imm_no_spouse_date"></div></div>
                    </div>
                </div>
                <div class="form-section theme-green">
                    <div class="dynamic-header"><h2 class="section-title" style="margin:0;"><span class="icon">üë∂</span> Section B - Children</h2><button type="button" class="btn btn-add" onclick="addFamilyChild()">+ Add Child</button></div>
                    <div id="familyChildrenList" style="margin-top:20px;"></div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-top:20px; margin-bottom:15px; border:2px solid #e2e8f0; border-top: 3px dashed #cbd5e1;">
                        <p style="font-weight:700; font-size:13px; margin-bottom:10px;">Note: If no children, certification required</p>
                        <p style="font-size:13px; margin-bottom:10px;">I certify that I do not have any natural, adopted nor step-children.</p>
                        <div class="row row-2"><div><label>Signature</label><input type="text" name="imm_no_children_sig"></div><div><label>Date</label><input type="date" name="imm_no_children_date"></div></div>
                    </div>
                </div>
                <div class="form-section theme-blue">
                    <div class="dynamic-header"><h2 class="section-title" style="margin:0;"><span class="icon">üë´</span> Section C - Brothers and Sisters</h2><button type="button" class="btn btn-add" onclick="addFamilySibling()">+ Add Sibling</button></div>
                    <div id="familySiblingsList" style="margin-top:20px;"></div>
                </div>
                <div class="form-section theme-dark">
                    <h2 class="section-title"><span class="icon">‚úçÔ∏è</span> Section D - Certification</h2>
                    <div style="background:#f8fafc; padding:20px; border-radius:14px; margin-bottom:15px;">
                        <p style="font-weight:700; font-size:14px; margin-bottom:10px;">I certify that the information contained in this document is complete, accurate and factual.</p>
                        <div class="row row-2"><div><label>Full Name (typed signature)</label><input type="text" name="imm_cert_name"></div><div><label>Date (YYYY-MM-DD)</label><input type="date" name="imm_cert_date"></div></div>
                    </div>
                </div>
                `;
                container.innerHTML = html;
                submitArea.style.display = 'block';
                addFamilyChild();
                addFamilySibling();
                return;
            }

            // CLIENT PROFILE FORM
            // H&C APPLICATION FORM
            if (config.showHCForm) {
                html = `
                <div class="form-section theme-blue">
                    <h2 class="section-title"><span class="icon">üë§</span> Personal Information</h2>
                    <div class="row row-2"><div><label>Given Name(s)</label><input type="text" name="givenName" placeholder="As shown on passport"></div><div><label>Family Name</label><input type="text" name="familyName" placeholder="As shown on passport"></div></div>
                    <div class="row row-3"><div><label>Date of Birth</label><input type="date" name="dob"></div><div><label>Place of Birth</label><input type="text" name="pob" placeholder="City, Country"></div><div><label>Sex</label><select name="sex"><option value="">Select</option><option value="male">Male</option><option value="female">Female</option><option value="other">Other</option></select></div></div>
                    <div class="row row-2"><div><label>UCI Number (if known)</label><input type="text" name="uci_number"></div><div><label>Country of Citizenship</label><input type="text" name="citizenship"></div></div>
                    <div class="row"><label>Other Citizenships (if any)</label><input type="text" name="other_citizenship" placeholder="Comma-separated"></div>
                </div>
                <div class="form-section theme-dark">
                    <h2 class="section-title"><span class="icon">üõÇ</span> Passport / Travel Document</h2>
                    <div class="row row-2"><div><label>Passport Number</label><input type="text" name="passportNum"></div><div><label>Country of Issue</label><input type="text" name="passport_country"></div></div>
                    <div class="row row-2"><div><label>Issue Date</label><input type="date" name="passportIssue"></div><div><label>Expiry Date</label><input type="date" name="passportExpiry"></div></div>
                </div>
                <div class="form-section theme-green">
                    <h2 class="section-title"><span class="icon">üìß</span> Contact Information</h2>
                    <div class="row row-2"><div><label>Email</label><input type="email" name="email"></div><div><label>Phone</label><input type="tel" name="phone"></div></div>
                    <div class="row"><label>Current Address - Street</label><input type="text" name="address"></div>
                    <div class="row row-3"><div><label>City</label><input type="text" name="city"></div><div><label>Province</label><input type="text" name="province"></div><div><label>Postal Code</label><input type="text" name="postalCode"></div></div>
                    <div class="row"><label>Country</label><input type="text" name="country"></div>
                    <div class="row"><label>Is this your mailing address?</label><select name="is_mailing_address" id="is_mailing_address" onchange="document.getElementById('mailing_address_details').style.display = this.value === 'no' ? 'block' : 'none'"><option value="yes">Yes</option><option value="no">No</option></select></div>
                    <div id="mailing_address_details" style="display:none; margin-top:15px;">
                        <div class="row"><label>Mailing Address - Street</label><input type="text" name="mailing_street"></div>
                        <div class="row row-3"><div><label>City</label><input type="text" name="mailing_city"></div><div><label>Province</label><input type="text" name="mailing_province"></div><div><label>Postal Code</label><input type="text" name="mailing_postal"></div></div>
                        <div class="row"><label>Country</label><input type="text" name="mailing_country"></div>
                    </div>
                </div>
                <div class="form-section" style="border-left-color: var(--color-orange);">
                    <h2 class="section-title"><span class="icon">üçÅ</span> Current Status in Canada</h2>
                    <div class="row"><label>Current Immigration Status</label><select name="hc_current_status"><option value="">Select</option><option value="visitor">Visitor</option><option value="student">Student (Study Permit)</option><option value="worker">Worker (Work Permit)</option><option value="refugee_claimant">Refugee Claimant</option><option value="no_status">No Status / Undocumented</option><option value="trp">Temporary Resident Permit</option><option value="other">Other</option></select></div>
                    <div class="row row-2"><div><label>Status Document Number</label><input type="text" name="hc_status_doc_number"></div><div><label>Status Expiry Date</label><input type="date" name="hc_status_expiry"></div></div>
                    <div class="row row-2"><div><label>Date of Entry to Canada</label><input type="date" name="hc_entry_date"></div><div><label>Place of Entry to Canada</label><input type="text" name="hc_entry_place" placeholder="e.g., Vancouver, Toronto"></div></div>
                    <div class="row"><label>Are you currently subject to a removal order?</label><select name="hc_removal_order" id="hc_removal_order" onchange="document.getElementById('hc_removal_order_details').style.display = this.value === 'yes' ? 'block' : 'none'"><option value="no">No</option><option value="yes">Yes</option></select></div>
                    <div id="hc_removal_order_details" style="display:none; margin-top:15px;">
                        <div class="row row-2"><div><label>Type of Removal Order</label><input type="text" name="hc_removal_type" placeholder="e.g., Deportation, Exclusion"></div><div><label>Date Issued</label><input type="date" name="hc_removal_date"></div></div>
                        <div class="row"><label>Additional Details</label><textarea name="hc_removal_details" rows="3"></textarea></div>
                    </div>
                </div>
                <div class="form-section" style="border-left-color: var(--color-cyan);">
                    <h2 class="section-title"><span class="icon">üõ°Ô∏è</span> Refugee Claim History</h2>
                    <div class="row"><label>Have you ever made a refugee claim in Canada?</label><select name="hc_refugee_claim" id="hc_refugee_claim" onchange="document.getElementById('hc_refugee_claim_details').style.display = this.value === 'yes' ? 'block' : 'none'"><option value="no">No</option><option value="yes">Yes</option></select></div>
                    <div id="hc_refugee_claim_details" style="display:none; margin-top:15px;">
                        <div class="row row-2"><div><label>Date of Claim</label><input type="date" name="hc_claim_date"></div><div><label>Outcome</label><select name="hc_claim_outcome"><option value="">Select</option><option value="accepted">Accepted</option><option value="rejected">Rejected</option><option value="withdrawn">Withdrawn</option><option value="abandoned">Abandoned</option></select></div></div>
                        <div class="row row-2"><div><label>Date of Outcome</label><input type="date" name="hc_claim_outcome_date"></div><div><label>Has 12 months passed since rejection?</label><select name="hc_12_months_passed"><option value="">Select</option><option value="yes">Yes</option><option value="no">No</option></select></div></div>
                    </div>
                </div>
                <div class="form-section" style="border-left-color: var(--color-purple);">
                    <h2 class="section-title"><span class="icon">üìã</span> Previous Immigration Applications</h2>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <p style="font-weight:700; margin-bottom:12px;">Have you ever applied for permanent residence in Canada?</p>
                        <select name="hc_pr_application" id="hc_pr_application" onchange="document.getElementById('hc_pr_application_details').style.display = this.value === 'yes' ? 'block' : 'none'" style="width:100%; max-width:200px; padding:12px 16px; border:2px solid #e2e8f0; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer;">
                            <option value="no">No</option><option value="yes">Yes</option>
                        </select>
                        <div id="hc_pr_application_details" style="display:none; margin-top:15px;"><label>Details:</label><textarea name="hc_pr_application_details_text" rows="2"></textarea></div>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <p style="font-weight:700; margin-bottom:12px;">Have you been refused entry or a visa to Canada or any other country?</p>
                        <select name="hc_visa_refused" id="hc_visa_refused" onchange="document.getElementById('hc_visa_refused_details').style.display = this.value === 'yes' ? 'block' : 'none'" style="width:100%; max-width:200px; padding:12px 16px; border:2px solid #e2e8f0; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer;">
                            <option value="no">No</option><option value="yes">Yes</option>
                        </select>
                        <div id="hc_visa_refused_details" style="display:none; margin-top:15px;"><div id="hcRefusalList"></div><button type="button" class="btn btn-add" onclick="addHCRefusal()" style="margin-top:10px;">+ Add Refusal</button></div>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <p style="font-weight:700; margin-bottom:12px;">Have you ever been deported from any country?</p>
                        <select name="hc_deported" id="hc_deported" onchange="document.getElementById('hc_deported_details').style.display = this.value === 'yes' ? 'block' : 'none'" style="width:100%; max-width:200px; padding:12px 16px; border:2px solid #e2e8f0; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer;">
                            <option value="no">No</option><option value="yes">Yes</option>
                        </select>
                        <div id="hc_deported_details" style="display:none; margin-top:15px;"><label>Details:</label><textarea name="hc_deported_details_text" rows="2"></textarea></div>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <p style="font-weight:700; margin-bottom:12px;">Have you ever overstayed your status in any country?</p>
                        <select name="hc_overstayed" id="hc_overstayed" onchange="document.getElementById('hc_overstayed_details').style.display = this.value === 'yes' ? 'block' : 'none'" style="width:100%; max-width:200px; padding:12px 16px; border:2px solid #e2e8f0; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer;">
                            <option value="no">No</option><option value="yes">Yes</option>
                        </select>
                        <div id="hc_overstayed_details" style="display:none; margin-top:15px;"><label>Details:</label><textarea name="hc_overstayed_details_text" rows="2"></textarea></div>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <p style="font-weight:700; margin-bottom:12px;">Do you have a criminal record in any country?</p>
                        <select name="hc_criminal_record" id="hc_criminal_record" onchange="document.getElementById('hc_criminal_record_details').style.display = this.value === 'yes' ? 'block' : 'none'" style="width:100%; max-width:200px; padding:12px 16px; border:2px solid #e2e8f0; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer;">
                            <option value="no">No</option><option value="yes">Yes</option>
                        </select>
                        <div id="hc_criminal_record_details" style="display:none; margin-top:15px;"><label>Details:</label><textarea name="hc_criminal_record_details_text" rows="2"></textarea></div>
                    </div>
                </div>
                <div class="form-section" style="border-left-color: var(--color-red);">
                    <h2 class="section-title"><span class="icon">üè†</span> Person Living With Before Coming to Canada</h2>
                    <p style="font-size:13px; color:#64748b; margin-bottom:15px;">If you were living with someone before coming to Canada, provide their information:</p>
                    <div class="row row-2"><div><label>Family Name</label><input type="text" name="hc_before_family_name"></div><div><label>Given Name(s)</label><input type="text" name="hc_before_given_name"></div></div>
                    <div class="row row-3"><div><label>Sex</label><select name="hc_before_sex"><option value="">Select</option><option value="male">Male</option><option value="female">Female</option><option value="other">Other</option></select></div><div><label>Relationship</label><input type="text" name="hc_before_relationship"></div><div><label>Country of Birth</label><input type="text" name="hc_before_cob"></div></div>
                    <div class="row"><label>Full Address</label><input type="text" name="hc_before_address"></div>
                </div>
                <div class="form-section" style="border-left-color: var(--color-green);">
                    <h2 class="section-title"><span class="icon">üèòÔ∏è</span> Current Living Arrangements in Canada</h2>
                    <div class="row"><label>Are you currently living with someone in Canada?</label><select name="hc_living_with_canada" id="hc_living_with_canada" onchange="document.getElementById('hc_living_with_canada_details').style.display = this.value === 'yes' ? 'block' : 'none'"><option value="no">No</option><option value="yes">Yes</option></select></div>
                    <div id="hc_living_with_canada_details" style="display:none; margin-top:15px;">
                        <div class="row row-2"><div><label>Family Name</label><input type="text" name="hc_living_family_name"></div><div><label>Given Name(s)</label><input type="text" name="hc_living_given_name"></div></div>
                        <div class="row row-2"><div><label>Relationship</label><input type="text" name="hc_living_relationship"></div><div><label>Contact Number</label><input type="tel" name="hc_living_contact"></div></div>
                        <div class="row"><label>Full Address</label><input type="text" name="hc_living_address"></div>
                    </div>
                </div>
                <div class="form-section theme-purple">
                    <h2 class="section-title"><span class="icon">üíç</span> Family Information - Marital Status</h2>
                    <div class="row"><label>Current Marital Status</label><select name="maritalStatus" id="maritalStatus_hc" onchange="document.getElementById('hc_spouse_section').style.display = ['married', 'common_law'].includes(this.value) ? 'block' : 'none'"><option value="single">Single</option><option value="married">Married</option><option value="common_law">Common-Law</option><option value="separated">Separated</option><option value="divorced">Divorced</option><option value="widowed">Widowed</option></select></div>
                    <div id="hc_spouse_section" style="display:none; margin-top:20px;">
                        <div class="spouse-box">
                            <h4>Spouse / Partner Information</h4>
                            <div class="row row-2"><div><label>Full Name</label><input type="text" name="spouseName"></div><div><label>Date of Birth</label><input type="date" name="spouseDOB"></div></div>
                            <div class="row row-2"><div><label>Country of Birth</label><input type="text" name="hc_spouse_birthcountry"></div><div><label>Citizenship</label><input type="text" name="hc_spouse_citizenship"></div></div>
                            <div class="row row-2"><div><label>Current Occupation</label><input type="text" name="hc_spouse_occupation"></div><div><label>Immigration Status in Canada</label><select name="hc_spouse_immstatus"><option value="">Select</option><option value="citizen">Canadian Citizen</option><option value="pr">Permanent Resident</option><option value="work">Work Permit</option><option value="study">Study Permit</option><option value="visitor">Visitor</option><option value="no_status">No Status</option><option value="other">Other</option></select></div></div>
                        </div>
                    </div>
                </div>
                <div class="form-section" style="border-left-color: var(--color-orange);">
                    <h2 class="section-title"><span class="icon">üë®‚Äçüë©</span> Parents Information</h2>
                    <div style="background:#fef3c7; padding:15px; border-radius:10px; margin-bottom:20px; border-left:4px solid var(--color-orange);">
                        <p style="font-weight:700; margin-bottom:10px;">Mother</p>
                    </div>
                    <div class="row row-2"><div><label>Full Name</label><input type="text" name="motherName"></div><div><label>Date of Birth</label><input type="date" name="motherDOB"></div></div>
                    <div class="row row-2"><div><label>Country of Birth</label><input type="text" name="motherBirthCountry"></div><div><label>Citizenship</label><input type="text" name="motherCitizenship"></div></div>
                    <div class="row row-2"><div><label>Address (or if deceased)</label><input type="text" name="hc_mother_address"></div><div><label>In Canada?</label><select name="hc_mother_in_canada"><option value="no">No</option><option value="yes">Yes</option></select></div></div>
                    <div style="background:#dbeafe; padding:15px; border-radius:10px; margin:20px 0 20px 0; border-left:4px solid var(--color-blue);">
                        <p style="font-weight:700; margin-bottom:10px;">Father</p>
                    </div>
                    <div class="row row-2"><div><label>Full Name</label><input type="text" name="fatherName"></div><div><label>Date of Birth</label><input type="date" name="fatherDOB"></div></div>
                    <div class="row row-2"><div><label>Country of Birth</label><input type="text" name="fatherBirthCountry"></div><div><label>Citizenship</label><input type="text" name="fatherCitizenship"></div></div>
                    <div class="row row-2"><div><label>Address (or if deceased)</label><input type="text" name="hc_father_address"></div><div><label>In Canada?</label><select name="hc_father_in_canada"><option value="no">No</option><option value="yes">Yes</option></select></div></div>
                </div>
                <div class="form-section theme-green">
                    <div class="dynamic-header"><h2 class="section-title" style="margin:0;"><span class="icon">üë∂</span> Children</h2><button type="button" class="btn btn-add" onclick="addHCChild()">+ Add Child</button></div>
                    <div id="hcChildrenList" style="margin-top:20px;"></div>
                </div>
                <div class="form-section" style="border-left-color: var(--color-cyan);">
                    <div class="dynamic-header"><h2 class="section-title" style="margin:0;"><span class="icon">üë•</span> Siblings in Canada</h2><button type="button" class="btn btn-add" onclick="addHCSibling()">+ Add Sibling</button></div>
                    <div id="hcSiblingsList" style="margin-top:20px;"></div>
                </div>
                <div class="form-section" style="border-left-color: #f43f5e;">
                    <div class="dynamic-header"><h2 class="section-title" style="margin:0;"><span class="icon">üë´</span> Other Family/Friends in Canada</h2><button type="button" class="btn btn-add" onclick="addHCFamilyCanada()">+ Add Person</button></div>
                    <div id="hcFamilyCanadaList" style="margin-top:20px;"></div>
                </div>
                <div class="form-section" style="border-left-color: var(--color-red); background:linear-gradient(135deg, rgba(212,36,38,0.02) 0%, rgba(212,36,38,0.05) 100%);">
                    <h2 class="section-title"><span class="icon">üåç</span> Establishment in Canada - Length of Time</h2>
                    <p style="font-size:13px; color:#64748b; margin-bottom:15px; font-style:italic;">Demonstrate your roots and integration in Canada - one of the key factors in H&C assessment.</p>
                    <div class="row row-2"><div><label>Date of First Arrival</label><input type="date" name="hc_first_arrival"></div><div><label>Years in Canada (approx)</label><input type="number" name="hc_years_in_canada" step="0.5"></div></div>
                    <div class="row"><label>Have you lived in Canada continuously?</label><select name="hc_continuous_residence" id="hc_continuous_residence" onchange="document.getElementById('hc_gaps_details').style.display = this.value === 'no' ? 'block' : 'none'"><option value="yes">Yes</option><option value="no">No</option></select></div>
                    <div id="hc_gaps_details" style="display:none; margin-top:15px;"><label>Explain any gaps (e.g., travel, temporary leaves):</label><textarea name="hc_residence_gaps" rows="2"></textarea></div>
                </div>
                <div class="form-section" style="border-left-color: var(--color-green); background:linear-gradient(135deg, rgba(5,150,105,0.02) 0%, rgba(5,150,105,0.05) 100%);">
                    <h2 class="section-title"><span class="icon">üíº</span> Establishment in Canada - Employment</h2>
                    <div class="row"><label>Are you currently employed?</label><select name="hc_currently_employed" id="hc_currently_employed" onchange="document.getElementById('hc_current_employment_details').style.display = this.value === 'yes' ? 'block' : 'none'"><option value="no">No</option><option value="yes">Yes</option></select></div>
                    <div id="hc_current_employment_details" style="display:none; margin-top:15px;">
                        <div class="row row-2"><div><label>Employer Name</label><input type="text" name="hc_employer_name"></div><div><label>Job Title</label><input type="text" name="hc_job_title"></div></div>
                        <div class="row row-3"><div><label>Start Date</label><input type="date" name="hc_employment_start"></div><div><label>Employment Type</label><select name="hc_employment_type"><option value="full_time">Full-time</option><option value="part_time">Part-time</option><option value="self_employed">Self-employed</option></select></div><div><label>Annual Income (CAD)</label><input type="number" name="hc_employment_income"></div></div>
                    </div>
                    <div class="dynamic-header" style="margin-top:20px;"><h3 style="margin:0; font-size:15px; font-weight:600;">Previous Employment in Canada</h3><button type="button" class="btn btn-add" onclick="addHCEmployment()">+ Add Previous Job</button></div>
                    <div id="hcEmploymentList" style="margin-top:15px;"></div>
                </div>
                <div class="form-section" style="border-left-color: var(--color-blue); background:linear-gradient(135deg, rgba(37,99,235,0.02) 0%, rgba(37,99,235,0.05) 100%);">
                    <h2 class="section-title"><span class="icon">üéì</span> Establishment in Canada - Education</h2>
                    <div class="row"><label>Have you studied in Canada?</label><select name="hc_studied_canada" id="hc_studied_canada" onchange="document.getElementById('hc_education_details').style.display = this.value === 'yes' ? 'block' : 'none'"><option value="no">No</option><option value="yes">Yes</option></select></div>
                    <div id="hc_education_details" style="display:none; margin-top:15px;">
                        <div class="row row-2"><div><label>Institution Name</label><input type="text" name="hc_institution"></div><div><label>Program/Course</label><input type="text" name="hc_program"></div></div>
                        <div class="row row-3"><div><label>From</label><input type="month" name="hc_edu_from"></div><div><label>To</label><input type="month" name="hc_edu_to"></div><div><label>Completed?</label><select name="hc_edu_completed"><option value="yes">Yes</option><option value="no">No</option></select></div></div>
                    </div>
                </div>
                <div class="form-section" style="border-left-color: var(--color-purple); background:linear-gradient(135deg, rgba(124,58,237,0.02) 0%, rgba(124,58,237,0.05) 100%);">
                    <h2 class="section-title"><span class="icon">ü§ù</span> Establishment in Canada - Community Involvement</h2>
                    <div class="row"><label>Community Involvement & Volunteer Work</label><textarea name="hc_community_involvement" rows="3" placeholder="Describe any volunteer work, community organizations, religious groups, etc."></textarea></div>
                    <div class="row row-2"><div><label>Languages Spoken</label><input type="text" name="hc_languages" placeholder="e.g., English, French, Spanish"></div><div><label>English Proficiency</label><select name="hc_english_proficiency"><option value="">Select</option><option value="basic">Basic</option><option value="intermediate">Intermediate</option><option value="advanced">Advanced</option><option value="fluent">Fluent</option></select></div></div>
                    <div class="row"><label>French Proficiency</label><select name="hc_french_proficiency"><option value="">Select</option><option value="none">None</option><option value="basic">Basic</option><option value="intermediate">Intermediate</option><option value="advanced">Advanced</option><option value="fluent">Fluent</option></select></div>
                </div>
                <div class="form-section" style="border-left-color: var(--color-orange); background:linear-gradient(135deg, rgba(245,158,11,0.02) 0%, rgba(245,158,11,0.05) 100%);">
                    <h2 class="section-title"><span class="icon">üí∞</span> Establishment in Canada - Financial Self-Sufficiency</h2>
                    <div class="row"><label>How do you currently support yourself financially?</label><select name="hc_financial_support"><option value="">Select</option><option value="employment">Employment</option><option value="savings">Savings</option><option value="family_support">Family Support</option><option value="social_assistance">Social Assistance</option><option value="combination">Combination of above</option><option value="other">Other</option></select></div>
                    <div class="row"><label>Have you filed Canadian income taxes?</label><select name="hc_filed_taxes" id="hc_filed_taxes" onchange="document.getElementById('hc_tax_years_details').style.display = this.value === 'yes' ? 'block' : 'none'"><option value="no">No</option><option value="yes">Yes</option></select></div>
                    <div id="hc_tax_years_details" style="display:none; margin-top:15px;"><label>Which years have you filed?</label><input type="text" name="hc_tax_years" placeholder="e.g., 2021, 2022, 2023"></div>
                    <div class="row row-2"><div><label>Do you have a Canadian bank account?</label><select name="hc_bank_account"><option value="no">No</option><option value="yes">Yes</option></select></div><div><label>Housing Status</label><select name="hc_housing_status"><option value="">Select</option><option value="own">Own</option><option value="rent">Rent</option><option value="family_friends">Living with family/friends</option><option value="shelter">Shelter</option><option value="other">Other</option></select></div></div>
                    <div class="row"><label>Do you own any property in Canada?</label><select name="hc_own_property"><option value="no">No</option><option value="yes">Yes</option></select></div>
                </div>
                <div class="form-section" style="border-left-color: #ec4899; background:linear-gradient(135deg, rgba(236,72,153,0.02) 0%, rgba(236,72,153,0.05) 100%);">
                    <h2 class="section-title"><span class="icon">üò¢</span> Hardship Assessment - Describe Your Situation</h2>
                    <p style="font-size:13px; color:#64748b; margin-bottom:15px; font-style:italic;">This is a critical section. Explain in detail the hardship you would face if your application is denied and you must return to your home country.</p>
                    <div class="row"><label>Country you would return to if application denied</label><input type="text" name="hc_return_country"></div>
                    <div class="row"><label>Describe the hardship you would face</label><textarea name="hc_hardship_description" rows="5" placeholder="Provide detailed explanation of the difficulties and dangers you would face..."></textarea></div>
                    <div class="row"><label>Specific hardship factors (select all that apply):</label></div>
                    <div style="background:white; padding:15px; border-radius:10px; border:2px solid #e2e8f0;">
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                            <div><input type="checkbox" name="hc_hardship_healthcare" id="hc_hardship_healthcare"> <label for="hc_hardship_healthcare" style="display:inline; font-size:13px;">Lack of adequate healthcare</label></div>
                            <div><input type="checkbox" name="hc_hardship_mental_health" id="hc_hardship_mental_health"> <label for="hc_hardship_mental_health" style="display:inline; font-size:13px;">Mental health concerns</label></div>
                            <div><input type="checkbox" name="hc_hardship_discrimination" id="hc_hardship_discrimination"> <label for="hc_hardship_discrimination" style="display:inline; font-size:13px;">Risk of discrimination</label></div>
                            <div><input type="checkbox" name="hc_hardship_violence" id="hc_hardship_violence"> <label for="hc_hardship_violence" style="display:inline; font-size:13px;">Domestic violence/abuse</label></div>
                            <div><input type="checkbox" name="hc_hardship_political" id="hc_hardship_political"> <label for="hc_hardship_political" style="display:inline; font-size:13px;">Political instability/war</label></div>
                            <div><input type="checkbox" name="hc_hardship_education" id="hc_hardship_education"> <label for="hc_hardship_education" style="display:inline; font-size:13px;">Lack of education for children</label></div>
                            <div><input type="checkbox" name="hc_hardship_economic" id="hc_hardship_economic"> <label for="hc_hardship_economic" style="display:inline; font-size:13px;">Economic hardship</label></div>
                            <div><input type="checkbox" name="hc_hardship_family_separation" id="hc_hardship_family_separation"> <label for="hc_hardship_family_separation" style="display:inline; font-size:13px;">Separation from family</label></div>
                            <div><input type="checkbox" name="hc_hardship_country_conditions" id="hc_hardship_country_conditions"> <label for="hc_hardship_country_conditions" style="display:inline; font-size:13px;">Country conditions</label></div>
                            <div><input type="checkbox" name="hc_hardship_other" id="hc_hardship_other"> <label for="hc_hardship_other" style="display:inline; font-size:13px;">Other</label></div>
                        </div>
                    </div>
                    <div class="row" style="margin-top:20px;"><label>Do you have any medical conditions requiring treatment?</label><select name="hc_medical_conditions" id="hc_medical_conditions" onchange="document.getElementById('hc_medical_details').style.display = this.value === 'yes' ? 'block' : 'none'"><option value="no">No</option><option value="yes">Yes</option></select></div>
                    <div id="hc_medical_details" style="display:none; margin-top:15px;">
                        <div class="row"><label>Describe conditions</label><textarea name="hc_medical_description" rows="2"></textarea></div>
                        <div class="row row-2"><div><label>Treatment available in home country?</label><select name="hc_treatment_available"><option value="">Select</option><option value="yes">Yes</option><option value="no">No</option><option value="limited">Limited/Expensive</option></select></div><div><label>Doctor/Specialist name in Canada</label><input type="text" name="hc_doctor_name"></div></div>
                    </div>
                    <div class="row"><label>Are you receiving mental health support in Canada?</label><select name="hc_mental_health_support" id="hc_mental_health_support" onchange="document.getElementById('hc_mental_health_details').style.display = this.value === 'yes' ? 'block' : 'none'"><option value="no">No</option><option value="yes">Yes</option></select></div>
                    <div id="hc_mental_health_details" style="display:none; margin-top:15px;"><label>Details (therapist, clinic, etc.):</label><textarea name="hc_mental_health_description" rows="2"></textarea></div>
                    <div class="row"><label>Have you experienced domestic violence or abuse?</label><select name="hc_domestic_violence" id="hc_domestic_violence" onchange="document.getElementById('hc_domestic_violence_details').style.display = this.value === 'yes' ? 'block' : 'none'"><option value="no">No</option><option value="yes">Yes</option></select></div>
                    <div id="hc_domestic_violence_details" style="display:none; margin-top:15px;"><label>Details (optional):</label><textarea name="hc_domestic_violence_description" rows="2"></textarea></div>
                </div>
                <div class="form-section" style="border-left-color: #8b5cf6; background:linear-gradient(135deg, rgba(139,92,246,0.02) 0%, rgba(139,92,246,0.05) 100%);">
                    <h2 class="section-title"><span class="icon">üëß</span> Best Interests of the Child (BITC) Assessment</h2>
                    <p style="font-size:13px; color:#64748b; margin-bottom:15px; font-style:italic;">Complete this section only if you have dependent children.</p>
                    <div class="row"><label>Are there children directly affected by this application?</label><select name="hc_children_affected" id="hc_children_affected" onchange="document.getElementById('hc_bitc_details').style.display = this.value === 'yes' ? 'block' : 'none'"><option value="no">No</option><option value="yes">Yes</option></select></div>
                    <div id="hc_bitc_details" style="display:none; margin-top:15px;">
                        <div class="row row-2"><div><label>How many children?</label><input type="number" name="hc_bitc_children_count" min="1"></div><div><label>Are any Canadian citizens or PRs?</label><select name="hc_bitc_citizen_pr"><option value="no">No</option><option value="yes">Yes</option></select></div></div>
                        <div class="row"><label>Describe how children would be affected if application is denied</label><textarea name="hc_bitc_impact" rows="3" placeholder="Explain the impact on each child..."></textarea></div>
                        <div class="row"><label>Child-specific factors (select all that apply):</label></div>
                        <div style="background:white; padding:15px; border-radius:10px; border:2px solid #e2e8f0;">
                            <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                                <div><input type="checkbox" name="hc_bitc_born_canada" id="hc_bitc_born_canada"> <label for="hc_bitc_born_canada" style="display:inline; font-size:13px;">Child born in Canada</label></div>
                                <div><input type="checkbox" name="hc_bitc_school_canada" id="hc_bitc_school_canada"> <label for="hc_bitc_school_canada" style="display:inline; font-size:13px;">Attends school in Canada</label></div>
                                <div><input type="checkbox" name="hc_bitc_medical_special" id="hc_bitc_medical_special"> <label for="hc_bitc_medical_special" style="display:inline; font-size:13px;">Medical/special needs</label></div>
                                <div><input type="checkbox" name="hc_bitc_language_barriers" id="hc_bitc_language_barriers"> <label for="hc_bitc_language_barriers" style="display:inline; font-size:13px;">Language barriers in home country</label></div>
                                <div><input type="checkbox" name="hc_bitc_no_ties" id="hc_bitc_no_ties"> <label for="hc_bitc_no_ties" style="display:inline; font-size:13px;">No ties to home country</label></div>
                                <div><input type="checkbox" name="hc_bitc_no_access" id="hc_bitc_no_access"> <label for="hc_bitc_no_access" style="display:inline; font-size:13px;">Would lose access to education/healthcare</label></div>
                                <div><input type="checkbox" name="hc_bitc_family_separation" id="hc_bitc_family_separation"> <label for="hc_bitc_family_separation" style="display:inline; font-size:13px;">Separation from parent(s)</label></div>
                            </div>
                        </div>
                        <div class="row" style="margin-top:20px;"><label>Additional details about each child's situation</label><textarea name="hc_bitc_additional_details" rows="3"></textarea></div>
                    </div>
                </div>
                <div class="form-section" style="border-left-color: var(--color-cyan); background:linear-gradient(135deg, rgba(6,182,212,0.02) 0%, rgba(6,182,212,0.05) 100%);">
                    <h2 class="section-title"><span class="icon">‚öñÔ∏è</span> Exemptions Requested</h2>
                    <div class="row"><label>What specific exemptions from IRPA are you requesting?</label></div>
                    <div style="background:white; padding:15px; border-radius:10px; border:2px solid #e2e8f0;">
                        <div style="display:grid; grid-template-columns:1fr; gap:12px;">
                            <div><input type="checkbox" name="hc_exempt_apply_outside" id="hc_exempt_apply_outside"> <label for="hc_exempt_apply_outside" style="display:inline; font-size:13px;">Exemption from requirement to apply outside Canada</label></div>
                            <div><input type="checkbox" name="hc_exempt_inadmissibility" id="hc_exempt_inadmissibility"> <label for="hc_exempt_inadmissibility" style="display:inline; font-size:13px;">Exemption from inadmissibility (medical, criminal, financial, etc.)</label></div>
                            <div><input type="checkbox" name="hc_exempt_criteria" id="hc_exempt_criteria"> <label for="hc_exempt_criteria" style="display:inline; font-size:13px;">Exemption from not meeting criteria for any immigration class</label></div>
                            <div><input type="checkbox" name="hc_exempt_other" id="hc_exempt_other"> <label for="hc_exempt_other" style="display:inline; font-size:13px;">Other (specify below)</label></div>
                        </div>
                    </div>
                    <div class="row"><label>Provide details of the exemptions you are requesting</label><textarea name="hc_exempt_details" rows="3" placeholder="Explain why you need each exemption..."></textarea></div>
                </div>
                <div class="form-section" style="border-left-color: var(--color-green); background:linear-gradient(135deg, rgba(5,150,105,0.02) 0%, rgba(5,150,105,0.05) 100%);">
                    <h2 class="section-title"><span class="icon">üìë</span> Supporting Documents Checklist</h2>
                    <p style="font-size:13px; color:#64748b; margin-bottom:15px; font-style:italic;">Gather the following documents to support your application:</p>
                    <div style="background:white; padding:15px; border-radius:10px; border:2px solid #e2e8f0;">
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                            <div><input type="checkbox" name="hc_doc_passport" id="hc_doc_passport"> <label for="hc_doc_passport" style="display:inline; font-size:13px;">Passport/Travel Document</label></div>
                            <div><input type="checkbox" name="hc_doc_birth" id="hc_doc_birth"> <label for="hc_doc_birth" style="display:inline; font-size:13px;">Birth Certificate</label></div>
                            <div><input type="checkbox" name="hc_doc_status" id="hc_doc_status"> <label for="hc_doc_status" style="display:inline; font-size:13px;">Proof of Status in Canada</label></div>
                            <div><input type="checkbox" name="hc_doc_employment" id="hc_doc_employment"> <label for="hc_doc_employment" style="display:inline; font-size:13px;">Employment Letters/Records</label></div>
                            <div><input type="checkbox" name="hc_doc_taxes" id="hc_doc_taxes"> <label for="hc_doc_taxes" style="display:inline; font-size:13px;">Tax Returns (NOAs)</label></div>
                            <div><input type="checkbox" name="hc_doc_support_letters" id="hc_doc_support_letters"> <label for="hc_doc_support_letters" style="display:inline; font-size:13px;">Letters of Support</label></div>
                            <div><input type="checkbox" name="hc_doc_medical" id="hc_doc_medical"> <label for="hc_doc_medical" style="display:inline; font-size:13px;">Medical Reports</label></div>
                            <div><input type="checkbox" name="hc_doc_school" id="hc_doc_school"> <label for="hc_doc_school" style="display:inline; font-size:13px;">School Records</label></div>
                            <div><input type="checkbox" name="hc_doc_community" id="hc_doc_community"> <label for="hc_doc_community" style="display:inline; font-size:13px;">Community Involvement Proof</label></div>
                            <div><input type="checkbox" name="hc_doc_country_conditions" id="hc_doc_country_conditions"> <label for="hc_doc_country_conditions" style="display:inline; font-size:13px;">Country Condition Reports</label></div>
                            <div><input type="checkbox" name="hc_doc_police" id="hc_doc_police"> <label for="hc_doc_police" style="display:inline; font-size:13px;">Police Certificates</label></div>
                            <div><input type="checkbox" name="hc_doc_photos" id="hc_doc_photos"> <label for="hc_doc_photos" style="display:inline; font-size:13px;">Photos</label></div>
                            <div><input type="checkbox" name="hc_doc_financial" id="hc_doc_financial"> <label for="hc_doc_financial" style="display:inline; font-size:13px;">Financial Documents</label></div>
                            <div><input type="checkbox" name="hc_doc_other" id="hc_doc_other"> <label for="hc_doc_other" style="display:inline; font-size:13px;">Other Relevant Documents</label></div>
                        </div>
                    </div>
                </div>
                <div class="form-section theme-dark">
                    <h2 class="section-title"><span class="icon">‚úçÔ∏è</span> Declaration & Additional Information</h2>
                    <div style="background:#f8fafc; padding:20px; border-radius:14px; margin-bottom:15px;">
                        <p style="font-weight:700; font-size:14px; margin-bottom:15px;">Declaration</p>
                        <p style="font-size:13px; margin-bottom:15px;">I certify that the information provided in this application is complete, accurate, and factual. I understand that providing false or misleading information is an offence under Section 127 of the Immigration and Refugee Protection Act.</p>
                        <div class="row row-2"><div><label>Full Name (typed signature)</label><input type="text" name="hc_declaration_name"></div><div><label>Date</label><input type="date" name="hc_declaration_date"></div></div>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <p style="font-weight:700; margin-bottom:12px;">Anything else you want us to consider?</p>
                        <textarea name="hc_additional_info" rows="4" placeholder="Any additional information or documents..."></textarea>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <p style="font-weight:700; margin-bottom:12px;">How did you hear about Waymark Immigration?</p>
                        <select name="referral" style="width:100%; max-width:300px;"><option value="">Select</option><option value="google">Google Search</option><option value="social">Social Media</option><option value="friend">Friend/Family Referral</option><option value="returning">Returning Client</option><option value="other">Other</option></select>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <p style="font-weight:700; margin-bottom:12px;">Preferred Language of Communication</p>
                        <select name="preferred_language" style="width:100%; max-width:300px;"><option value="english">English</option><option value="french">Fran√ßais</option><option value="spanish">Espa√±ol</option><option value="mandarin">‰∏≠Êñá (Mandarin)</option><option value="other">Other</option></select>
                    </div>
                </div>
                `;
                container.innerHTML = html;
                submitArea.style.display = 'block';
                addHCChild();
                addHCSibling();
                addHCFamilyCanada();
                addHCEmployment();
                return;
            }
            // CLIENT PROFILE FORM
            if (config.showClientProfileForm) {
                html = `
                <div class="form-section theme-blue">
                    <h2 class="section-title"><span class="icon">üë§</span> Personal Information</h2>
                    <div class="row row-2"><div><label>Full Legal Name - Given Names</label><input type="text" name="givenName"></div><div><label>Family Name / Surname</label><input type="text" name="familyName"></div></div>
                    <div class="row row-3"><div><label>Date of Birth</label><input type="date" name="dob"></div><div><label>Place of Birth - City</label><input type="text" name="pob"></div><div><label>Place of Birth - Country</label><input type="text" name="pob_country"></div></div>
                    <div class="row row-2"><div><label>Gender</label><select name="sex"><option value="">Select</option><option value="male">Male</option><option value="female">Female</option><option value="other">Other</option></select></div><div><label>Country of Citizenship</label><input type="text" name="citizenship"></div></div>
                    <div class="row"><label>Other Citizenships (if any)</label><input type="text" name="other_citizenship" placeholder="Comma-separated"></div>
                </div>
                <div class="form-section theme-green">
                    <h2 class="section-title"><span class="icon">üìß</span> Contact Information</h2>
                    <div class="row row-2"><div><label>Email</label><input type="email" name="email"></div><div><label>Phone</label><input type="tel" name="phone"></div></div>
                    <div class="row"><label>Current Address - Street</label><input type="text" name="address"></div>
                    <div class="row row-3"><div><label>City</label><input type="text" name="city"></div><div><label>Province/State</label><input type="text" name="province"></div><div><label>Postal Code</label><input type="text" name="postalCode"></div></div>
                    <div class="row"><label>Country</label><input type="text" name="country"></div>
                    <div class="row"><label>Mailing Address (if different)</label><input type="text" name="mailing_address" placeholder="Leave blank if same as above"></div>
                </div>
                <div class="form-section theme-dark">
                    <h2 class="section-title"><span class="icon">üõÇ</span> Passport / ID</h2>
                    <div class="row row-2"><div><label>Passport Number</label><input type="text" name="passportNum"></div><div><label>Country of Issue</label><input type="text" name="passport_issue_country"></div></div>
                    <div class="row row-2"><div><label>Issue Date</label><input type="date" name="passportIssue"></div><div><label>Expiry Date</label><input type="date" name="passportExpiry"></div></div>
                </div>
                <div class="form-section theme-red">
                    <h2 class="section-title"><span class="icon">üçÅ</span> Current Immigration Status</h2>
                    <div class="row"><label>Current Status in Canada</label><select name="current_status"><option value="">Select</option><option value="citizen">Canadian Citizen</option><option value="pr">Permanent Resident</option><option value="work_permit">Work Permit</option><option value="study_permit">Study Permit</option><option value="visitor">Visitor</option><option value="refugee_claimant">Refugee Claimant</option><option value="no_status">No Status</option><option value="other">Other</option></select></div>
                    <div class="row row-2"><div><label>Status Expiry Date</label><input type="date" name="status_expiry_date"></div><div><label>UCI Number (if applicable)</label><input type="text" name="uci_number"></div></div>
                    <div class="row"><label>Are you currently in Canada?</label><select name="in_canada"><option value="yes">Yes</option><option value="no">No</option></select></div>
                </div>
                <div class="form-section theme-purple">
                    <h2 class="section-title"><span class="icon">üìö</span> Immigration History</h2>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <p style="font-weight:700; margin-bottom:12px;">Have you ever applied to immigrate to Canada before?</p>
                        <select name="prev_canada_app" id="prev_canada_app" onchange="document.getElementById('prev_canada_app_detail').style.display = this.value === 'yes' ? 'block' : 'none'" style="width:100%; max-width:200px; padding:12px 16px; border:2px solid #e2e8f0; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer;">
                            <option value="no">No</option><option value="yes">Yes</option>
                        </select>
                        <div id="prev_canada_app_detail" style="display:none; margin-top:15px;"><label>Details:</label><textarea name="prev_canada_app_detail_text" rows="3"></textarea></div>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <p style="font-weight:700; margin-bottom:12px;">Have you ever been refused a visa or entry to Canada?</p>
                        <select name="visa_refused_canada" id="visa_refused_canada" onchange="document.getElementById('visa_refused_canada_detail').style.display = this.value === 'yes' ? 'block' : 'none'" style="width:100%; max-width:200px; padding:12px 16px; border:2px solid #e2e8f0; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer;">
                            <option value="no">No</option><option value="yes">Yes</option>
                        </select>
                        <div id="visa_refused_canada_detail" style="display:none; margin-top:15px;"><div id="refusalHistoryList"></div><button type="button" class="btn btn-add" onclick="addRefusalHistory()" style="margin-top:10px;">+ Add Refusal</button></div>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <p style="font-weight:700; margin-bottom:12px;">Have you ever been refused a visa or entry to any other country?</p>
                        <select name="visa_refused_other" id="visa_refused_other" onchange="document.getElementById('visa_refused_other_detail').style.display = this.value === 'yes' ? 'block' : 'none'" style="width:100%; max-width:200px; padding:12px 16px; border:2px solid #e2e8f0; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer;">
                            <option value="no">No</option><option value="yes">Yes</option>
                        </select>
                        <div id="visa_refused_other_detail" style="display:none; margin-top:15px;"><label>Details:</label><textarea name="visa_refused_other_detail_text" rows="3"></textarea></div>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <p style="font-weight:700; margin-bottom:12px;">Have you ever been deported or asked to leave any country?</p>
                        <select name="deported" id="deported" onchange="document.getElementById('deported_detail').style.display = this.value === 'yes' ? 'block' : 'none'" style="width:100%; max-width:200px; padding:12px 16px; border:2px solid #e2e8f0; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer;">
                            <option value="no">No</option><option value="yes">Yes</option>
                        </select>
                        <div id="deported_detail" style="display:none; margin-top:15px;"><label>Details:</label><textarea name="deported_detail_text" rows="3"></textarea></div>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <p style="font-weight:700; margin-bottom:12px;">Have you ever overstayed your status in any country?</p>
                        <select name="overstayed" id="overstayed" onchange="document.getElementById('overstayed_detail').style.display = this.value === 'yes' ? 'block' : 'none'" style="width:100%; max-width:200px; padding:12px 16px; border:2px solid #e2e8f0; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer;">
                            <option value="no">No</option><option value="yes">Yes</option>
                        </select>
                        <div id="overstayed_detail" style="display:none; margin-top:15px;"><label>Details:</label><textarea name="overstayed_detail_text" rows="3"></textarea></div>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <p style="font-weight:700; margin-bottom:12px;">Have you ever had a criminal conviction?</p>
                        <select name="criminal_conviction" id="criminal_conviction" onchange="document.getElementById('criminal_conviction_detail').style.display = this.value === 'yes' ? 'block' : 'none'" style="width:100%; max-width:200px; padding:12px 16px; border:2px solid #e2e8f0; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer;">
                            <option value="no">No</option><option value="yes">Yes</option>
                        </select>
                        <div id="criminal_conviction_detail" style="display:none; margin-top:15px;"><label>Details:</label><textarea name="criminal_conviction_detail_text" rows="3"></textarea></div>
                    </div>
                </div>
                <div class="form-section theme-blue">
                    <h2 class="section-title"><span class="icon">üìÇ</span> Previous Applications with Waymark</h2>
                    <div class="row"><label>Have you been a previous client of Waymark Immigration?</label><select name="prev_client" id="prev_client" onchange="document.getElementById('prev_client_details').style.display = this.value === 'yes' ? 'block' : 'none'"><option value="no">No</option><option value="yes">Yes</option></select></div>
                    <div id="prev_client_details" style="display:none; margin-top:15px;">
                        <div class="row row-2"><div><label>Application Type</label><input type="text" name="prev_app_type"></div><div><label>File/Reference Number</label><input type="text" name="prev_ref_number"></div></div>
                    </div>
                </div>
                <div class="form-section theme-green">
                    <h2 class="section-title"><span class="icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span> Family Overview</h2>
                    <div class="row row-2"><div><label>Marital Status</label><select name="maritalStatus"><option value="">Select</option><option value="single">Single</option><option value="married">Married</option><option value="common_law">Common-Law</option><option value="divorced">Divorced</option><option value="widowed">Widowed</option></select></div><div><label>Spouse/Partner Name (if applicable)</label><input type="text" name="spouse_name_profile"></div></div>
                    <div class="row"><label>Number of Dependent Children</label><input type="number" name="num_children" placeholder="0"></div>
                    <div class="row"><label>Do you have family members in Canada?</label><select name="family_in_canada" id="family_in_canada" onchange="document.getElementById('family_in_canada_detail').style.display = this.value === 'yes' ? 'block' : 'none'"><option value="no">No</option><option value="yes">Yes</option></select></div>
                    <div id="family_in_canada_detail" style="display:none; margin-top:15px;"><label>Details:</label><textarea name="family_in_canada_detail_text" rows="3"></textarea></div>
                </div>
                <div class="form-section theme-orange">
                    <h2 class="section-title"><span class="icon">üéØ</span> Purpose of Consultation</h2>
                    <div class="row"><label>What immigration service are you seeking?</label><select name="service_seeking"><option value="">Select</option><option value="visitor">Visitor Visa</option><option value="study">Study Permit</option><option value="work">Work Permit</option><option value="pr">Permanent Residence</option><option value="sponsorship">Sponsorship</option><option value="citizenship">Citizenship</option><option value="refugee">Refugee Claim</option><option value="other">Other</option></select></div>
                    <div class="row"><label>Brief description of your situation</label><textarea name="situation_description" rows="4" placeholder="Tell us about your immigration goals and current situation..."></textarea></div>
                </div>
                <div class="form-section theme-dark">
                    <h2 class="section-title"><span class="icon">‚úçÔ∏è</span> Declaration & Additional Info</h2>
                    <div style="background:#f8fafc; padding:20px; border-radius:14px; margin-bottom:15px;">
                        <p style="font-weight:700; font-size:14px; margin-bottom:15px;">Declaration</p>
                        <p style="font-size:13px; margin-bottom:15px;">I declare that the information provided above is true and complete to the best of my knowledge. I understand this form is for record-keeping purposes.</p>
                        <div class="row row-2"><div><label>Full Name (typed signature)</label><input type="text" name="declaration_name"></div><div><label>Date</label><input type="date" name="declaration_date"></div></div>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <p style="font-weight:700; margin-bottom:12px;">Preferred Language of Communication</p>
                        <select name="preferred_language" style="width:100%; max-width:300px;"><option value="english">English</option><option value="french">Fran√ßais</option><option value="spanish">Espa√±ol</option><option value="mandarin">‰∏≠Êñá (Mandarin)</option><option value="other">Other</option></select>
                    </div>
                    <div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                        <p style="font-weight:700; margin-bottom:12px;">How did you hear about Waymark Immigration?</p>
                        <select name="referral_source" style="width:100%; max-width:300px;"><option value="">Select</option><option value="google">Google Search</option><option value="social">Social Media</option><option value="friend">Friend/Family Referral</option><option value="website">Website</option><option value="immigration_forum">Immigration Forum</option><option value="other">Other</option></select>
                    </div>
                    <div class="row"><label>Anything else we should know? (internal notes)</label><textarea name="additionalInfo" rows="4"></textarea></div>
                </div>
                `;
                container.innerHTML = html;
                submitArea.style.display = 'block';
                addRefusalHistory();
                return;
            }

            container.innerHTML = html;
            submitArea.style.display = 'block';

            // Initialize country list
            addCountry();
            if (config.showEducation) addEducation();
            if (config.showWork && !config.showForeignExp) addWork();
            if (config.showForeignExp) addForeignExp();
            if (config.showCanadianExp) addCanadianExp();
            if (config.showAbsences) addAbsence();
            if (config.showTravel) addTravel();
            
            // Show spouse details section when marital status is married/common-law
            if (config.showSpouseDetails) {
                const maritalSelect = document.getElementById('maritalStatus');
                const origToggle = toggleSpouse;
                window.toggleSpouse = function() {
                    origToggle();
                    const spouseDetailsSection = document.getElementById('spouseDetailsSection');
                    if (spouseDetailsSection) {
                        const status = maritalSelect.value;
                        spouseDetailsSection.style.display = ['married', 'common_law'].includes(status) ? 'block' : 'none';
                    }
                };
            }
        }

        // Toggle Functions
        function toggleSpouse() {
            const status = document.getElementById('maritalStatus').value;
            const section = document.getElementById('spouseSection');
            if (section) section.style.display = ['married', 'common_law', 'separated', 'divorced', 'widowed'].includes(status) ? 'block' : 'none';
        }

        function togglePreviousRelationship() {
            const val = document.getElementById('hasPreviousRelationship').value;
            const section = document.getElementById('previousRelationshipSection');
            if (section) section.classList.toggle('show', val === 'yes');
        }

        // Dynamic Add Functions
        function addEducation() {
            idx.edu++;
            const c = document.getElementById('educationList');
            c.insertAdjacentHTML('beforeend', `<div class="repeater-item" id="edu_${idx.edu}"><div class="repeater-header"><strong>Education #${idx.edu}</strong>${idx.edu > 1 ? `<button type="button" class="btn btn-remove" onclick="removeItem('edu_${idx.edu}')">Remove</button>` : ''}</div><div class="row row-2"><div><label>Name of Degree/Diploma</label><input type="text" name="edu_field_${idx.edu}" placeholder="e.g., Bachelor of Commerce"></div><div><label>Institution</label><input type="text" name="edu_school_${idx.edu}"></div></div><div class="row row-3"><div><label>Country</label><input type="text" name="edu_country_${idx.edu}"></div><div><label>From</label><input type="month" name="edu_from_${idx.edu}"></div><div><label>To</label><input type="month" name="edu_to_${idx.edu}"></div></div></div>`);
        }

        function addWork() {
            idx.work++;
            const c = document.getElementById('workList');
            c.insertAdjacentHTML('beforeend', `<div class="repeater-item" id="work_${idx.work}"><div class="repeater-header"><strong>Job #${idx.work}</strong>${idx.work > 1 ? `<button type="button" class="btn btn-remove" onclick="removeItem('work_${idx.work}')">Remove</button>` : ''}</div><div class="row row-2"><div><label>Job Title</label><input type="text" name="work_title_${idx.work}"></div><div><label>Company</label><input type="text" name="work_company_${idx.work}"></div></div><div class="row row-2"><div><label>City</label><input type="text" name="work_city_${idx.work}"></div><div><label>Country</label><input type="text" name="work_country_${idx.work}"></div></div><div class="row row-2"><div><label>From</label><input type="month" name="work_from_${idx.work}"></div><div><label>To</label><input type="month" name="work_to_${idx.work}"></div></div></div>`);
        }

        function addForeignExp() {
            idx.foreignExp++;
            const c = document.getElementById('foreignExpList');
            c.insertAdjacentHTML('beforeend', `<div class="repeater-item" id="foreignExp_${idx.foreignExp}"><div class="repeater-header"><strong>Foreign Job #${idx.foreignExp}</strong>${idx.foreignExp > 1 ? `<button type="button" class="btn btn-remove" onclick="removeItem('foreignExp_${idx.foreignExp}')">Remove</button>` : ''}</div><div class="row row-2"><div><label>Job Title</label><input type="text" name="fexp_title_${idx.foreignExp}"></div><div><label>NOC Code (if known)</label><input type="text" name="fexp_noc_${idx.foreignExp}" placeholder="e.g., 21232"></div></div><div class="row row-2"><div><label>Company / Employer</label><input type="text" name="fexp_company_${idx.foreignExp}"></div><div><label>Country</label><input type="text" name="fexp_country_${idx.foreignExp}"></div></div><div class="row row-3"><div><label>Hours / Week</label><select name="fexp_hours_${idx.foreignExp}"><option value="">Select</option><option value="30+">30+ hrs/wk (Full-time)</option><option value="15-29">15-29 hrs/wk (Part-time)</option><option value="<15">Less than 15 hrs/wk</option></select></div><div><label>From</label><input type="month" name="fexp_from_${idx.foreignExp}"></div><div><label>To</label><input type="month" name="fexp_to_${idx.foreignExp}"></div></div><div class="row"><label>Main Duties</label><textarea name="fexp_duties_${idx.foreignExp}" rows="2" placeholder="Briefly describe your main duties..."></textarea></div></div>`);
        }

        function addCanadianExp() {
            idx.canadianExp++;
            const c = document.getElementById('canadianExpList');
            c.insertAdjacentHTML('beforeend', `<div class="repeater-item" id="canadianExp_${idx.canadianExp}"><div class="repeater-header"><strong>Canadian Job #${idx.canadianExp}</strong>${idx.canadianExp > 1 ? `<button type="button" class="btn btn-remove" onclick="removeItem('canadianExp_${idx.canadianExp}')">Remove</button>` : ''}</div><div class="row row-2"><div><label>Job Title</label><input type="text" name="cexp_title_${idx.canadianExp}"></div><div><label>NOC Code (if known)</label><input type="text" name="cexp_noc_${idx.canadianExp}" placeholder="e.g., 21232"></div></div><div class="row row-2"><div><label>Company / Employer</label><input type="text" name="cexp_company_${idx.canadianExp}"></div><div><label>City, Province</label><input type="text" name="cexp_city_${idx.canadianExp}" placeholder="e.g., Vancouver, BC"></div></div><div class="row row-3"><div><label>Hours / Week</label><select name="cexp_hours_${idx.canadianExp}"><option value="">Select</option><option value="30+">30+ hrs/wk (Full-time)</option><option value="15-29">15-29 hrs/wk (Part-time)</option><option value="<15">Less than 15 hrs/wk</option></select></div><div><label>From</label><input type="month" name="cexp_from_${idx.canadianExp}"></div><div><label>To</label><input type="month" name="cexp_to_${idx.canadianExp}"></div></div><div class="row row-2"><div><label>Work Permit Type</label><select name="cexp_permit_${idx.canadianExp}"><option value="">Select</option><option value="lmia_closed">LMIA / Closed Work Permit</option><option value="open">Open Work Permit</option><option value="pgwp">PGWP</option><option value="coop">Co-op Work Permit</option><option value="pr">Permanent Resident</option><option value="citizen">Canadian Citizen</option><option value="other">Other</option></select></div><div><label>Main Duties</label><textarea name="cexp_duties_${idx.canadianExp}" rows="2" placeholder="Briefly describe your main duties..."></textarea></div></div></div>`);
        }

        function addChild() {
            idx.child++;
            const c = document.getElementById('childrenList');
            c.style.display = 'block';
            if (document.getElementById('hasChildren')) document.getElementById('hasChildren').value = 'yes';
            c.insertAdjacentHTML('beforeend', `<div class="repeater-item" id="child_${idx.child}"><div class="repeater-header"><strong>Child #${idx.child}</strong>${idx.child > 1 ? `<button type="button" class="btn btn-remove" onclick="removeItem('child_${idx.child}')">Remove</button>` : ''}</div><div class="row row-2"><div><label>Full Name</label><input type="text" name="child_name_${idx.child}"></div><div><label>Date of Birth</label><input type="date" name="child_dob_${idx.child}"></div></div><div class="row row-3"><div><label>Country of Birth</label><input type="text" name="child_birthCountry_${idx.child}"></div><div><label>Citizenship</label><input type="text" name="child_citizenship_${idx.child}"></div><div><label>Sex</label><select name="child_sex_${idx.child}"><option value="">Select</option><option value="male">Male</option><option value="female">Female</option></select></div></div><div class="row row-2"><div><label>Marital Status</label><select name="child_marital_${idx.child}"><option value="single">Single</option><option value="married">Married</option></select></div><div><label>Current Country of Residence</label><input type="text" name="child_residence_${idx.child}"></div></div><div class="row"><label>Will this child accompany you to Canada?</label><select name="child_accompanying_${idx.child}"><option value="yes">Yes</option><option value="no">No</option></select></div></div>`);
        }

        function addSibling() {
            idx.sibling++;
            const c = document.getElementById('siblingsList');
            c.style.display = 'block';
            if (document.getElementById('hasSiblings')) document.getElementById('hasSiblings').value = 'yes';
            c.insertAdjacentHTML('beforeend', `<div class="repeater-item" id="sibling_${idx.sibling}"><div class="repeater-header"><strong>Sibling #${idx.sibling}</strong>${idx.sibling > 1 ? `<button type="button" class="btn btn-remove" onclick="removeItem('sibling_${idx.sibling}')">Remove</button>` : ''}</div><div class="row row-2"><div><label>Full Name</label><input type="text" name="sibling_name_${idx.sibling}"></div><div><label>Date of Birth</label><input type="date" name="sibling_dob_${idx.sibling}"></div></div><div class="row row-3"><div><label>Country of Residence</label><input type="text" name="sibling_residence_${idx.sibling}"></div><div><label>Citizenship</label><input type="text" name="sibling_citizenship_${idx.sibling}"></div><div><label>Immigration Status (if in Canada)</label><select name="sibling_immStatus_${idx.sibling}"><option value="">N/A - Not in Canada</option><option value="citizen">Canadian Citizen</option><option value="pr">Permanent Resident</option><option value="temporary">Temporary Resident</option></select></div></div><div class="row"><label>Relationship</label><select name="sibling_relation_${idx.sibling}"><option value="brother">Brother</option><option value="sister">Sister</option><option value="half_brother">Half-Brother</option><option value="half_sister">Half-Sister</option><option value="step_brother">Step-Brother</option><option value="step_sister">Step-Sister</option></select></div></div>`);
        }

        function addTravel() {
            idx.travel++;
            const c = document.getElementById('travelList');
            c.insertAdjacentHTML('beforeend', `<div class="repeater-item" id="travel_${idx.travel}"><div class="repeater-header"><strong>Trip #${idx.travel}</strong>${idx.travel > 1 ? `<button type="button" class="btn btn-remove" onclick="removeItem('travel_${idx.travel}')">Remove</button>` : ''}</div><div class="row row-2"><div><label>Country Visited</label><input type="text" name="travel_country_${idx.travel}"></div><div><label>Purpose of Travel</label><select name="travel_purpose_${idx.travel}"><option value="">Select</option><option value="tourism">Tourism</option><option value="business">Business</option><option value="study">Study</option><option value="work">Work</option><option value="family">Family Visit</option><option value="medical">Medical</option><option value="other">Other</option></select></div></div><div class="row row-3"><div><label>From</label><input type="month" name="travel_from_${idx.travel}"></div><div><label>To</label><input type="month" name="travel_to_${idx.travel}"></div><div><label>Duration</label><input type="text" name="travel_duration_${idx.travel}" placeholder="e.g., 2 weeks"></div></div></div>`);
        }

        function addAbsence() {
            idx.absence++;
            const c = document.getElementById('absenceList');
            c.insertAdjacentHTML('beforeend', `<div class="repeater-item" id="absence_${idx.absence}"><div class="repeater-header"><strong>Absence #${idx.absence}</strong>${idx.absence > 1 ? `<button type="button" class="btn btn-remove" onclick="removeItem('absence_${idx.absence}')">Remove</button>` : ''}</div><div class="row row-2"><div><label>Country Visited</label><input type="text" name="absence_country_${idx.absence}"></div><div><label>Reason for Absence</label><select name="absence_reason_${idx.absence}"><option value="">Select</option><option value="vacation">Vacation / Travel</option><option value="work">Work / Business</option><option value="family">Family Reasons</option><option value="medical">Medical</option><option value="study">Study</option><option value="other">Other</option></select></div></div><div class="row row-3"><div><label>Departure Date</label><input type="date" name="absence_from_${idx.absence}"></div><div><label>Return Date</label><input type="date" name="absence_to_${idx.absence}"></div><div><label>Total Days Absent</label><input type="number" name="absence_days_${idx.absence}" placeholder="e.g., 14"></div></div></div>`);
        }

        function removeItem(id) {
            document.getElementById(id)?.remove();
        }

        function addCountry() {
            idx.country++;
            const c = document.getElementById('countryList');
            c.insertAdjacentHTML('beforeend', `<div class="repeater-item" id="country_${idx.country}"><div class="repeater-header"><strong>Country #${idx.country}</strong>${idx.country > 1 ? `<button type="button" class="btn btn-remove" onclick="removeItem('country_${idx.country}')">Remove</button>` : ''}</div><div class="row row-3"><div><label>Country</label><input type="text" name="country_name_${idx.country}" placeholder="e.g., UAE"></div><div><label>From</label><input type="month" name="country_from_${idx.country}"></div><div><label>To</label><input type="month" name="country_to_${idx.country}"></div></div><div class="row"><label>Immigration Status in that country</label><input type="text" name="country_status_${idx.country}" placeholder="e.g., Work Visa, Student, Citizen"></div></div>`);
        }

        function bgQuestion(name, text) {
            return `<div style="background:white; padding:20px; border-radius:14px; margin-bottom:15px; border:2px solid #e2e8f0;">
                <p style="font-weight:700; margin-bottom:12px;">${text}</p>
                <select name="${name}" id="${name}" onchange="toggleBgDetails('${name}')" style="width:100%; max-width:200px; padding:12px 16px; border:2px solid #e2e8f0; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer;">
                    <option value="no">No</option>
                    <option value="yes">Yes</option>
                </select>
                <div id="d_${name}" style="display:none; margin-top:15px;">
                    <label style="font-size:13px;">Please provide details:</label>
                    <textarea name="${name}_detail" rows="3" style="margin-top:8px;" placeholder="Explain the circumstances..."></textarea>
                </div>
            </div>`;
        }

        // New functions for refugee claim form
        function addPreviousAddress() {
            idx.prevAddress++;
            const c = document.getElementById('prevAddressList');
            if (!c) return;
            c.insertAdjacentHTML('beforeend', `<div class="repeater-item" id="prevAddr_${idx.prevAddress}"><div class="repeater-header"><strong>Address #${idx.prevAddress}</strong>${idx.prevAddress > 1 ? `<button type="button" class="btn btn-remove" onclick="removeItem('prevAddr_${idx.prevAddress}')">Remove</button>` : ''}</div><div class="row row-3"><div><label>Started (MM/YY)</label><input type="text" name="ref_prev_addr_from_${idx.prevAddress}" placeholder="MM/YY"></div><div><label>Ended (MM/YY)</label><input type="text" name="ref_prev_addr_to_${idx.prevAddress}" placeholder="MM/YY"></div><div><label>Status</label><input type="text" name="ref_prev_addr_status_${idx.prevAddress}" placeholder="e.g., Work Visa"></div></div><div class="row row-2"><div><label>Street Name/Number</label><input type="text" name="ref_prev_addr_street_${idx.prevAddress}"></div><div><label>City</label><input type="text" name="ref_prev_addr_city_${idx.prevAddress}"></div></div><div class="row row-3"><div><label>State/Province</label><input type="text" name="ref_prev_addr_province_${idx.prevAddress}"></div><div><label>Postal Code</label><input type="text" name="ref_prev_addr_postal_${idx.prevAddress}"></div><div><label>Country</label><input type="text" name="ref_prev_addr_country_${idx.prevAddress}"></div></div></div>`);
        }

        function addTravelRoute() {
            idx.travelRoute++;
            const c = document.getElementById('travelRouteList');
            if (!c) return;
            c.insertAdjacentHTML('beforeend', `<div class="repeater-item" id="travelRoute_${idx.travelRoute}"><div class="repeater-header"><strong>Route Segment #${idx.travelRoute}</strong>${idx.travelRoute > 1 ? `<button type="button" class="btn btn-remove" onclick="removeItem('travelRoute_${idx.travelRoute}')">Remove</button>` : ''}</div><div class="row row-2"><div><label>Date Departed</label><input type="date" name="ref_travel_route_depart_${idx.travelRoute}"></div><div><label>From (Airport/City/Country)</label><input type="text" name="ref_travel_route_from_${idx.travelRoute}"></div></div><div class="row row-2"><div><label>Arrival Date</label><input type="date" name="ref_travel_route_arrive_${idx.travelRoute}"></div><div><label>To (Airport/City/Country)</label><input type="text" name="ref_travel_route_to_${idx.travelRoute}"></div></div><div class="row"><label>Notes</label><textarea name="ref_travel_route_notes_${idx.travelRoute}" rows="2"></textarea></div></div>`);
        }

        function addRefugeeChild() {
            idx.refChild++;
            const c = document.getElementById('refChildrenList');
            if (!c) return;
            c.insertAdjacentHTML('beforeend', `<div class="repeater-item" id="refChild_${idx.refChild}"><div class="repeater-header"><strong>Child #${idx.refChild}</strong>${idx.refChild > 1 ? `<button type="button" class="btn btn-remove" onclick="removeItem('refChild_${idx.refChild}')">Remove</button>` : ''}</div><div class="row row-2"><div><label>Surname</label><input type="text" name="ref_child_surname_${idx.refChild}"></div><div><label>Given/First Name</label><input type="text" name="ref_child_given_${idx.refChild}"></div></div><div class="row row-3"><div><label>Date of Birth</label><input type="date" name="ref_child_dob_${idx.refChild}"></div><div><label>Relationship</label><input type="text" name="ref_child_relationship_${idx.refChild}"></div><div><label>Country/Territory of Birth</label><input type="text" name="ref_child_birth_country_${idx.refChild}"></div></div><div class="row"><label>Does this child live with you?</label><select name="ref_child_lives_with_${idx.refChild}" onchange="document.getElementById('ref_child_address_${idx.refChild}').style.display = this.value === 'no' ? 'block' : 'none'"><option value="yes">Yes</option><option value="no">No</option></select></div><div id="ref_child_address_${idx.refChild}" style="display:none; margin-top:10px;"><label>Full Address</label><input type="text" name="ref_child_address_${idx.refChild}"></div></div>`);
        }

        // Functions for family info form
        function addFamilyChild() {
            idx.familyChild++;
            const c = document.getElementById('familyChildrenList');
            if (!c) return;
            c.insertAdjacentHTML('beforeend', `<div class="repeater-item" id="famChild_${idx.familyChild}"><div class="repeater-header"><strong>Child #${idx.familyChild}</strong>${idx.familyChild > 1 ? `<button type="button" class="btn btn-remove" onclick="removeItem('famChild_${idx.familyChild}')">Remove</button>` : ''}</div><div class="row row-2"><div><label>Name</label><input type="text" name="imm_child_name_${idx.familyChild}"></div><div><label>Relationship</label><select name="imm_child_rel_${idx.familyChild}"><option value="son">Son</option><option value="daughter">Daughter</option><option value="adopted_son">Adopted Son</option><option value="adopted_daughter">Adopted Daughter</option><option value="step_son">Step-son</option><option value="step_daughter">Step-daughter</option></select></div></div><div class="row row-2"><div><label>Date of Birth (YYYY-MM-DD)</label><input type="date" name="imm_child_dob_${idx.familyChild}"></div><div><label>Country of Birth</label><input type="text" name="imm_child_cob_${idx.familyChild}"></div></div><div class="row row-2"><div><label>Marital Status</label><input type="text" name="imm_child_marital_${idx.familyChild}"></div><div><label>Present Occupation</label><input type="text" name="imm_child_occupation_${idx.familyChild}"></div></div><div class="row"><label>Present Address (or if deceased: city/town, country, date)</label><input type="text" name="imm_child_address_${idx.familyChild}"></div><div class="row"><label>Will accompany you to Canada?</label><select name="imm_child_accompany_${idx.familyChild}"><option value="yes">Yes</option><option value="no">No</option></select></div></div>`);
        }

        function addFamilySibling() {
            idx.familySibling++;
            const c = document.getElementById('familySiblingsList');
            if (!c) return;
            c.insertAdjacentHTML('beforeend', `<div class="repeater-item" id="famSib_${idx.familySibling}"><div class="repeater-header"><strong>Sibling #${idx.familySibling}</strong>${idx.familySibling > 1 ? `<button type="button" class="btn btn-remove" onclick="removeItem('famSib_${idx.familySibling}')">Remove</button>` : ''}</div><div class="row row-2"><div><label>Name</label><input type="text" name="imm_sibling_name_${idx.familySibling}"></div><div><label>Relationship</label><select name="imm_sibling_rel_${idx.familySibling}"><option value="brother">Brother</option><option value="sister">Sister</option><option value="half_brother">Half-brother</option><option value="half_sister">Half-sister</option><option value="step_brother">Step-brother</option><option value="step_sister">Step-sister</option></select></div></div><div class="row row-2"><div><label>Date of Birth (YYYY-MM-DD)</label><input type="date" name="imm_sibling_dob_${idx.familySibling}"></div><div><label>Country of Birth</label><input type="text" name="imm_sibling_cob_${idx.familySibling}"></div></div><div class="row row-2"><div><label>Marital Status</label><input type="text" name="imm_sibling_marital_${idx.familySibling}"></div><div><label>Present Occupation</label><input type="text" name="imm_sibling_occupation_${idx.familySibling}"></div></div><div class="row"><label>Present Address (or if deceased: city/town, country, date)</label><input type="text" name="imm_sibling_address_${idx.familySibling}"></div><div class="row"><label>Will accompany you to Canada?</label><select name="imm_sibling_accompany_${idx.familySibling}"><option value="yes">Yes</option><option value="no">No</option></select></div></div>`);
        }

        // Function for client profile form
        function addRefusalHistory() {
            idx.refusalHistory++;
            const c = document.getElementById('refusalHistoryList');
            if (!c) return;
            c.insertAdjacentHTML('beforeend', `<div class="repeater-item" id="refusal_${idx.refusalHistory}" style="margin-bottom:15px;"><div class="repeater-header"><strong>Refusal #${idx.refusalHistory}</strong>${idx.refusalHistory > 1 ? `<button type="button" class="btn btn-remove" onclick="removeItem('refusal_${idx.refusalHistory}')">Remove</button>` : ''}</div><div class="row row-2"><div><label>Date</label><input type="date" name="refusal_date_${idx.refusalHistory}"></div><div><label>Type (Visa/Entry)</label><input type="text" name="refusal_type_${idx.refusalHistory}"></div></div><div class="row row-2"><div><label>Country</label><input type="text" name="refusal_country_${idx.refusalHistory}"></div><div><label>Reason</label><textarea name="refusal_reason_${idx.refusalHistory}" rows="2"></textarea></div></div></div>`);
        }


        // H&C Form Repeater Functions
        function addHCChild() {
            idx.hcChild++;
            const c = document.getElementById('hcChildrenList');
            if (!c) return;
            c.insertAdjacentHTML('beforeend', `<div class="repeater-item" id="hcChild_${idx.hcChild}"><div class="repeater-header"><strong>Child #${idx.hcChild}</strong>${idx.hcChild > 1 ? `<button type="button" class="btn btn-remove" onclick="removeItem('hcChild_${idx.hcChild}')">Remove</button>` : ''}</div><div class="row row-2"><div><label>Full Name</label><input type="text" name="hc_child_name_${idx.hcChild}"></div><div><label>Date of Birth</label><input type="date" name="hc_child_dob_${idx.hcChild}"></div></div><div class="row row-3"><div><label>Country of Birth</label><input type="text" name="hc_child_birth_country_${idx.hcChild}"></div><div><label>Citizenship</label><input type="text" name="hc_child_citizenship_${idx.hcChild}"></div><div><label>Relationship</label><select name="hc_child_relationship_${idx.hcChild}"><option value="son">Son</option><option value="daughter">Daughter</option><option value="adopted_son">Adopted Son</option><option value="adopted_daughter">Adopted Daughter</option><option value="step_son">Step-son</option><option value="step_daughter">Step-daughter</option></select></div></div><div class="row row-2"><div><label>Marital Status</label><select name="hc_child_marital_${idx.hcChild}"><option value="single">Single</option><option value="married">Married</option><option value="separated">Separated</option></select></div><div><label>Address</label><input type="text" name="hc_child_address_${idx.hcChild}"></div></div><div class="row row-2"><div><label>In Canada?</label><select name="hc_child_in_canada_${idx.hcChild}"><option value="yes">Yes</option><option value="no">No</option></select></div><div><label>Will be included in H&C application?</label><select name="hc_child_included_${idx.hcChild}"><option value="yes">Yes</option><option value="no">No</option></select></div></div></div>`);
        }

        function addHCSibling() {
            idx.hcSibling++;
            const c = document.getElementById('hcSiblingsList');
            if (!c) return;
            c.insertAdjacentHTML('beforeend', `<div class="repeater-item" id="hcSib_${idx.hcSibling}"><div class="repeater-header"><strong>Sibling #${idx.hcSibling}</strong>${idx.hcSibling > 1 ? `<button type="button" class="btn btn-remove" onclick="removeItem('hcSib_${idx.hcSibling}')">Remove</button>` : ''}</div><div class="row row-2"><div><label>Full Name</label><input type="text" name="hc_sibling_name_${idx.hcSibling}"></div><div><label>Date of Birth</label><input type="date" name="hc_sibling_dob_${idx.hcSibling}"></div></div><div class="row row-3"><div><label>Country of Birth</label><input type="text" name="hc_sibling_birth_country_${idx.hcSibling}"></div><div><label>Citizenship</label><input type="text" name="hc_sibling_citizenship_${idx.hcSibling}"></div><div><label>Relationship</label><select name="hc_sibling_relationship_${idx.hcSibling}"><option value="brother">Brother</option><option value="sister">Sister</option><option value="half_brother">Half-Brother</option><option value="half_sister">Half-Sister</option><option value="step_brother">Step-Brother</option><option value="step_sister">Step-Sister</option></select></div></div><div class="row row-2"><div><label>Address</label><input type="text" name="hc_sibling_address_${idx.hcSibling}"></div><div><label>Immigration Status in Canada</label><select name="hc_sibling_immstatus_${idx.hcSibling}"><option value="citizen">Canadian Citizen</option><option value="pr">Permanent Resident</option><option value="work">Work Permit</option><option value="study">Study Permit</option><option value="visitor">Visitor</option><option value="no_status">No Status</option><option value="na">N/A - Not in Canada</option></select></div></div></div>`);
        }

        function addHCFamilyCanada() {
            idx.hcFamilyCanada++;
            const c = document.getElementById('hcFamilyCanadaList');
            if (!c) return;
            c.insertAdjacentHTML('beforeend', `<div class="repeater-item" id="hcFamCan_${idx.hcFamilyCanada}"><div class="repeater-header"><strong>Person #${idx.hcFamilyCanada}</strong>${idx.hcFamilyCanada > 1 ? `<button type="button" class="btn btn-remove" onclick="removeItem('hcFamCan_${idx.hcFamilyCanada}')">Remove</button>` : ''}</div><div class="row row-2"><div><label>Full Name</label><input type="text" name="hc_family_canada_name_${idx.hcFamilyCanada}"></div><div><label>Relationship</label><input type="text" name="hc_family_canada_relationship_${idx.hcFamilyCanada}" placeholder="e.g., Cousin, Uncle, Friend"></div></div><div class="row row-2"><div><label>Address</label><input type="text" name="hc_family_canada_address_${idx.hcFamilyCanada}"></div><div><label>Immigration Status</label><select name="hc_family_canada_immstatus_${idx.hcFamilyCanada}"><option value="citizen">Canadian Citizen</option><option value="pr">Permanent Resident</option><option value="work">Work Permit</option><option value="study">Study Permit</option><option value="visitor">Visitor</option><option value="other">Other</option></select></div></div></div>`);
        }

        function addHCEmployment() {
            idx.hcEmployment++;
            const c = document.getElementById('hcEmploymentList');
            if (!c) return;
            c.insertAdjacentHTML('beforeend', `<div class="repeater-item" id="hcEmp_${idx.hcEmployment}"><div class="repeater-header"><strong>Previous Job #${idx.hcEmployment}</strong>${idx.hcEmployment > 1 ? `<button type="button" class="btn btn-remove" onclick="removeItem('hcEmp_${idx.hcEmployment}')">Remove</button>` : ''}</div><div class="row row-2"><div><label>Employer Name</label><input type="text" name="hc_prev_employer_${idx.hcEmployment}"></div><div><label>Job Title</label><input type="text" name="hc_prev_job_title_${idx.hcEmployment}"></div></div><div class="row row-3"><div><label>From</label><input type="month" name="hc_prev_emp_from_${idx.hcEmployment}"></div><div><label>To</label><input type="month" name="hc_prev_emp_to_${idx.hcEmployment}"></div><div><label>City</label><input type="text" name="hc_prev_emp_city_${idx.hcEmployment}"></div></div></div>`);
        }

        function addHCRefusal() {
            idx.hcRefusal++;
            const c = document.getElementById('hcRefusalList');
            if (!c) return;
            c.insertAdjacentHTML('beforeend', `<div class="repeater-item" id="hcRef_${idx.hcRefusal}" style="margin-bottom:15px;"><div class="repeater-header"><strong>Refusal #${idx.hcRefusal}</strong>${idx.hcRefusal > 1 ? `<button type="button" class="btn btn-remove" onclick="removeItem('hcRef_${idx.hcRefusal}')">Remove</button>` : ''}</div><div class="row row-2"><div><label>Date</label><input type="date" name="hc_refusal_date_${idx.hcRefusal}"></div><div><label>Country</label><input type="text" name="hc_refusal_country_${idx.hcRefusal}"></div></div><div class="row row-2"><div><label>Type of Application</label><input type="text" name="hc_refusal_type_${idx.hcRefusal}" placeholder="e.g., Visa, Entry, Work Permit"></div><div><label>Reason</label><textarea name="hc_refusal_reason_${idx.hcRefusal}" rows="2"></textarea></div></div></div>`);
        }
        // Toggle background question details
        function toggleBgDetails(name) {
            const select = document.getElementById(name);
            const detailDiv = document.getElementById('d_' + name);
            if (select && detailDiv) {
                detailDiv.style.display = select.value === 'yes' ? 'block' : 'none';
            }
        }

        // Storage
        function saveToBrowser() {
            const formType = document.getElementById('formType').value;
            if (!formType) { showToast('Select application type first', 'error'); return; }
            const form = document.getElementById('mainForm');
            const formData = new FormData(form);
            const data = { formType, _idx: idx };
            for (let [k, v] of formData.entries()) {
                // Don't save honeypot fields
                if (k.startsWith('wm_')) continue;
                data[k] = v;
            }
            data._savedAt = new Date().toLocaleString();
            localStorage.setItem('waymark_form_data', JSON.stringify(data));
            document.getElementById('lastSaved').innerText = "‚úì Saved: " + data._savedAt;
            showToast('‚úÖ Progress saved!', 'success');
        }

        function loadFromBrowser() {
            const saved = localStorage.getItem('waymark_form_data');
            if (!saved) { showToast('No saved data', 'error'); return; }
            const data = JSON.parse(saved);
            document.getElementById('formType').value = data.formType;
            generateForm();
            if (data._idx) idx = data._idx;
            setTimeout(() => {
                Object.keys(data).forEach(k => {
                    if (k.startsWith('_') || k.startsWith('wm_')) return;
                    const el = document.querySelector(`[name="${k}"]`);
                    if (el) { 
                        if (el.type === 'radio') { 
                            const r = document.querySelector(`[name="${k}"][value="${data[k]}"]`); 
                            if (r) r.click(); 
                        } else if (el.type === 'checkbox') {
                            el.checked = data[k] === 'yes';
                        } else {
                            el.value = data[k]; 
                        }
                    }
                });
                toggleSpouse();
                if (data._savedAt) document.getElementById('lastSaved').innerText = "Loaded: " + data._savedAt;
                showToast('‚úÖ Data loaded!', 'success');
            }, 150);
        }

        function clearForm() { 
            if (confirm('Reset form?')) { 
                document.getElementById('mainForm').reset(); 
                document.getElementById('formType').value = ''; 
                generateForm(); 
            } 
        }

        // Bot check disabled - was causing issues with browser autofill
        function isBot() {
            return false;
        }

        // Check cooldown
        function isOnCooldown() {
            const now = Date.now();
            if (now - lastSubmitTime < SUBMIT_COOLDOWN) {
                const remaining = Math.ceil((SUBMIT_COOLDOWN - (now - lastSubmitTime)) / 1000);
                showToast(`‚è≥ Please wait ${remaining} seconds...`, 'error');
                return true;
            }
            return false;
        }

        // SIMPLE SUBMIT - DESKTOP FIX
        async function handleSubmit() {
            console.log('=== SUBMIT STARTED ===');
            
            // Check for bots (honeypot)
            if (isBot()) {
                showToast('‚úÖ Application submitted!', 'success');
                return;
            }

            // Check cooldown
            if (isOnCooldown()) {
                return;
            }

            const formType = document.getElementById('formType').value;
            if (!formType) {
                showToast('Please select application type first', 'error');
                return;
            }

            const btn = document.getElementById('submitBtn');
            const overlay = document.getElementById('loadingOverlay');
            const loadingText = document.getElementById('loadingText');
            
            lastSubmitTime = Date.now();
            btn.disabled = true;
            btn.innerHTML = '‚è≥ Processing...';
            overlay.classList.add('show');

            try {
                // Collect form data
                loadingText.textContent = 'Collecting information...';
                const formData = collectFormData();
                console.log('Form data collected');
                
                // Generate PDF
                loadingText.textContent = 'Creating PDF...';
                let pdfBlob = null;
                let pdfBase64 = '';
                
                try {
                    const { jsPDF } = window.jspdf;
                    if (!jsPDF) throw new Error('jsPDF not available');
                    
                    pdfBlob = await generatePDF();
                    console.log('PDF generated, size:', pdfBlob?.size);
                    
                    if (pdfBlob) {
                        pdfBase64 = await blobToBase64(pdfBlob);
                    }
                } catch (pdfErr) {
                    console.error('PDF error:', pdfErr);
                }

                // Send email first (more reliable)
                loadingText.textContent = 'Sending application...';
                const emailResult = await sendEmail(formData, pdfBase64, !!pdfBase64);
                console.log('Email result:', emailResult);

                // Then try to download PDF
                if (pdfBlob) {
                    loadingText.textContent = 'Downloading PDF...';
                    try {
                        // Simple download method
                        const url = window.URL.createObjectURL(pdfBlob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = getFileName();
                        link.style.display = 'none';
                        document.body.appendChild(link);
                        link.click();
                        
                        // Cleanup
                        setTimeout(() => {
                            window.URL.revokeObjectURL(url);
                            link.remove();
                        }, 1000);
                        
                        console.log('PDF download triggered');
                    } catch (dlErr) {
                        console.error('Download error:', dlErr);
                        // Fallback: open in new tab
                        const url = window.URL.createObjectURL(pdfBlob);
                        window.open(url, '_blank');
                    }
                }

                overlay.classList.remove('show');
                
                if (emailResult.success) {
                    showToast('‚úÖ Application submitted successfully!', 'success');
                } else {
                    showToast('‚ö†Ô∏è Submitted but email failed: ' + (emailResult.error || 'Unknown error'), 'error');
                }
                
            } catch (error) {
                console.error('Submit error:', error);
                overlay.classList.remove('show');
                showToast('‚ùå Error: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '‚úÖ Submit Application';
            }
        }

        function getFileName() {
            const formType = document.getElementById('formType').value;
            const config = FORM_CONFIG[formType];
            const givenName = document.querySelector('[name="givenName"]')?.value || 'Client';
            const familyName = document.querySelector('[name="familyName"]')?.value || '';
            const name = (givenName + '_' + familyName).replace(/[^a-zA-Z0-9_]/g, '').replace(/_+$/, '');
            const formName = (config?.name || formType).replace(/[^a-zA-Z0-9]/g, '_');
            const date = new Date().toISOString().split('T')[0];
            return `Waymark_${formName}_${name}_${date}.pdf`;
        }

        function collectFormData() {
            const formType = document.getElementById('formType').value;
            const config = FORM_CONFIG[formType];
            const form = document.getElementById('mainForm');
            const formData = new FormData(form);
            const data = {};
            
            for (let [k, v] of formData.entries()) {
                // Skip honeypot fields
                if (k.startsWith('wm_')) continue;
                // Sanitize input
                if (v) data[k] = sanitizeInput(v);
            }
            
            data._formType = formType;
            data._formName = config?.name || formType;
            data._submittedAt = new Date().toISOString();
            
            return data;
        }

        async function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const formType = document.getElementById('formType').value;
            const config = FORM_CONFIG[formType];
            const data = collectFormData();

            const red = [212, 36, 38];
            const blue = [37, 99, 235];
            const dark = [30, 41, 59];
            const green = [5, 150, 105];

            let y = 20;
            const pageHeight = 280;
            const leftMargin = 20;
            const rightMargin = 190;

            function checkPageBreak(needed = 20) {
                if (y + needed > pageHeight) {
                    doc.addPage();
                    y = 20;
                }
            }

            // Header
            doc.setFillColor(...red);
            doc.rect(0, 0, 220, 40, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(22);
            doc.setFont('helvetica', 'bold');
            doc.text('WAYMARK IMMIGRATION', 105, 18, { align: 'center' });
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text('Client Application Form', 105, 28, { align: 'center' });
            doc.setFontSize(9);
            doc.text('RCIC-IRB Licensed | R1034253', 105, 35, { align: 'center' });

            y = 50;

            // Application Type
            doc.setTextColor(...blue);
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('Application: ' + (config?.name || formType), leftMargin, y);
            y += 5;
            doc.setDrawColor(...blue);
            doc.setLineWidth(0.5);
            doc.line(leftMargin, y, rightMargin, y);
            y += 10;

            doc.setTextColor(...dark);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.text('Date: ' + new Date().toLocaleString(), leftMargin, y);
            y += 15;

            function addSection(title, color) {
                checkPageBreak(25);
                doc.setFillColor(...color);
                doc.rect(leftMargin - 2, y - 5, 4, 12, 'F');
                doc.setTextColor(...color);
                doc.setFontSize(13);
                doc.setFont('helvetica', 'bold');
                doc.text(title, leftMargin + 5, y + 3);
                y += 12;
            }

            function addField(label, value) {
                if (!value || value === '') return;
                checkPageBreak(12);
                doc.setTextColor(100, 100, 100);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'bold');
                doc.text(label + ':', leftMargin + 5, y);
                doc.setTextColor(...dark);
                doc.setFont('helvetica', 'normal');
                const lines = doc.splitTextToSize(String(value), 100);
                doc.text(lines, 80, y);
                y += (lines.length * 5) + 3;
            }

            // Personal
            addSection('PERSONAL INFORMATION', blue);
            addField('Given Name(s)', data.givenName);
            addField('Family Name', data.familyName);
            addField('Date of Birth', data.dob);
            addField('Place of Birth', data.pob);
            addField('Sex', data.sex);
            y += 5;

            // Passport
            addSection('PASSPORT', dark);
            addField('Passport Number', data.passportNum);
            addField('Citizenship', data.citizenship);
            addField('Issue Date', data.passportIssue);
            addField('Expiry Date', data.passportExpiry);
            y += 5;

            // Countries of Residence
            let countryCount = 1;
            while (data['country_name_' + countryCount]) {
                if (countryCount === 1) addSection('COUNTRIES OF RESIDENCE (6+ MONTHS)', green);
                addField('Country ' + countryCount, data['country_name_' + countryCount] + (data['country_status_' + countryCount] ? ' (' + data['country_status_' + countryCount] + ')' : '') + (data['country_from_' + countryCount] ? ' | ' + data['country_from_' + countryCount] + ' to ' + (data['country_to_' + countryCount] || 'Present') : ''));
                countryCount++;
            }
            if (countryCount > 1) y += 5;

            // Marital
            addSection('MARITAL STATUS', [124, 58, 237]);
            addField('Status', data.maritalStatus);
            addField('Spouse Name', data.spouseName);
            addField('Spouse DOB', data.spouseDOB);
            addField('Marriage Date', data.marriageDate);
            y += 5;

            // Contact
            addSection('CONTACT', green);
            addField('Email', data.email);
            addField('Phone', data.phone);
            addField('Address', data.address);
            addField('City', data.city);
            addField('Province', data.province);
            addField('Country', data.country);
            y += 5;

            // Entry to Canada
            if (data.firstEntryDate) {
                addSection('CANADA ENTRY', [249, 115, 22]);
                addField('First Entry', data.firstEntryDate);
                addField('Entry Place', data.firstEntryPlace);
                addField('Purpose', data.firstEntryPurpose);
                if (data.recentEntryDate) {
                    addField('Most Recent Entry', data.recentEntryDate);
                    addField('Recent Entry Place', data.recentEntryPlace);
                    addField('Recent Entry Purpose', data.recentEntryPurpose);
                }
                addField('Current Status', data.currentStatus);
                addField('Status From', data.statusFromDate);
                addField('Status Expiry', data.statusExpiry);
                y += 5;
            }

            // Spousal OWP Details
            if (data.sponsorUCI || data.sponsorAppNumber) {
                addSection('SPOUSAL OWP ‚Äî SPONSORSHIP DETAILS', [219, 39, 119]);
                addField('Sponsor UCI', data.sponsorUCI);
                addField('Application Number', data.sponsorAppNumber);
                addField('Application Submitted', data.sponsorAppDate);
                addField('AOR Received', data.receivedAOR);
                if (data.aorDate) addField('AOR Date', data.aorDate);
                addField('Sponsorship Category', data.sponsorCategory);
                addField('Living with Sponsor', data.livingWithSponsor);
                addField('Valid Status in Canada', data.hasValidStatus);
                addField('Inland Sponsorship', data.inlandSponsorship);
                addField('Previous OWP', data.previousOWP);
                y += 5;
            }

            // Employer
            if (data.employerName) {
                addSection('EMPLOYER', blue);
                addField('Employer', data.employerName);
                addField('Job Title', data.jobTitle);
                addField('Address', data.employerAddress);
                addField('LMIA', data.lmiaNum);
                addField('NOC', data.nocCode);
                addField('Wage', data.wage);
                y += 5;
            }

            // PR Details
            if (data.prDate || data.prCardNumber) {
                addSection('PERMANENT RESIDENCE DETAILS', red);
                addField('Date Became PR', data.prDate);
                addField('PR Card Number', data.prCardNumber);
                addField('PR Card Issue', data.prCardIssue);
                addField('PR Card Expiry', data.prCardExpiry);
                if (data.totalDaysInCanada) addField('Total Days in Canada (5 yrs)', data.totalDaysInCanada);
                if (data.filedTaxes) addField('Filed Taxes', data.filedTaxes);
                y += 5;
            }

            // Parents
            if (data.fatherName || data.motherName) {
                addSection('PARENTS', [249, 115, 22]);
                if (data.fatherName) {
                    addField('Father', data.fatherName + (data.fatherDOB ? ' | DOB: ' + data.fatherDOB : '') + (data.fatherBirthCountry ? ' | Born: ' + data.fatherBirthCountry : ''));
                    addField('Father Residence', (data.fatherResidence || '') + (data.fatherCitizenship ? ' | Citizenship: ' + data.fatherCitizenship : '') + (data.fatherImmStatus && data.fatherImmStatus !== '' ? ' | Imm Status: ' + data.fatherImmStatus : ''));
                    if (data.fatherOccupation) addField('Father Occupation', data.fatherOccupation);
                    if (data.fatherDeceased === 'yes') addField('Father Status', 'Deceased');
                }
                if (data.motherName) {
                    addField('Mother', data.motherName + (data.motherDOB ? ' | DOB: ' + data.motherDOB : '') + (data.motherBirthCountry ? ' | Born: ' + data.motherBirthCountry : ''));
                    addField('Mother Residence', (data.motherResidence || '') + (data.motherCitizenship ? ' | Citizenship: ' + data.motherCitizenship : '') + (data.motherImmStatus && data.motherImmStatus !== '' ? ' | Imm Status: ' + data.motherImmStatus : ''));
                    if (data.motherOccupation) addField('Mother Occupation', data.motherOccupation);
                    if (data.motherDeceased === 'yes') addField('Mother Status', 'Deceased');
                }
                y += 5;
            }

            // Children
            let childCount = 1;
            while (data['child_name_' + childCount]) {
                if (childCount === 1) addSection('CHILDREN / DEPENDENTS', green);
                addField('Child ' + childCount, (data['child_name_' + childCount] || '') + (data['child_dob_' + childCount] ? ' | DOB: ' + data['child_dob_' + childCount] : '') + (data['child_sex_' + childCount] ? ' | ' + data['child_sex_' + childCount] : '') + (data['child_citizenship_' + childCount] ? ' | Citizenship: ' + data['child_citizenship_' + childCount] : '') + (data['child_accompanying_' + childCount] ? ' | Accompanying: ' + data['child_accompanying_' + childCount] : ''));
                childCount++;
            }

            // Siblings
            let siblingCount = 1;
            while (data['sibling_name_' + siblingCount]) {
                if (siblingCount === 1) addSection('SIBLINGS', blue);
                addField('Sibling ' + siblingCount, (data['sibling_name_' + siblingCount] || '') + (data['sibling_relation_' + siblingCount] ? ' (' + data['sibling_relation_' + siblingCount] + ')' : '') + (data['sibling_dob_' + siblingCount] ? ' | DOB: ' + data['sibling_dob_' + siblingCount] : '') + (data['sibling_residence_' + siblingCount] ? ' | Residence: ' + data['sibling_residence_' + siblingCount] : '') + (data['sibling_immStatus_' + siblingCount] && data['sibling_immStatus_' + siblingCount] !== '' ? ' | Imm Status: ' + data['sibling_immStatus_' + siblingCount] : ''));
                siblingCount++;
            }

            // Education
            if (data.highestEduLevel || data.hasECA) {
                addSection('EDUCATION', blue);
                if (data.highestEduLevel) addField('Highest Level', data.highestEduLevel);
                if (data.eduInCanada && data.eduInCanada !== 'no') addField('Education in Canada', data.eduInCanada);
                if (data.hasECA) addField('ECA Completed', data.hasECA);
                if (data.ecaReportNumber) addField('ECA Report #', data.ecaReportNumber);
            }
            let eduCount = 1;
            while (data['edu_field_' + eduCount] || data['edu_school_' + eduCount]) {
                if (eduCount === 1 && !data.highestEduLevel && !data.hasECA) addSection('EDUCATION', blue);
                addField('Education ' + eduCount, (data['edu_field_' + eduCount] || '') + ' - ' + (data['edu_school_' + eduCount] || '') + (data['edu_country_' + eduCount] ? ' (' + data['edu_country_' + eduCount] + ')' : '') + (data['edu_from_' + eduCount] ? ' | ' + data['edu_from_' + eduCount] + ' to ' + (data['edu_to_' + eduCount] || 'Present') : ''));
                eduCount++;
            }

            // Work
            let workCount = 1;
            while (data['work_title_' + workCount]) {
                if (workCount === 1) addSection('WORK EXPERIENCE', [124, 58, 237]);
                addField('Job ' + workCount, (data['work_title_' + workCount] || '') + ' at ' + (data['work_company_' + workCount] || '') + (data['work_city_' + workCount] ? ', ' + data['work_city_' + workCount] : '') + (data['work_from_' + workCount] ? ' | ' + data['work_from_' + workCount] + ' to ' + (data['work_to_' + workCount] || 'Present') : ''));
                workCount++;
            }

            // Foreign Work Experience
            let fexpCount = 1;
            while (data['fexp_title_' + fexpCount]) {
                if (fexpCount === 1) addSection('FOREIGN WORK EXPERIENCE', [124, 58, 237]);
                addField('Foreign Job ' + fexpCount, (data['fexp_title_' + fexpCount] || '') + (data['fexp_noc_' + fexpCount] ? ' (NOC: ' + data['fexp_noc_' + fexpCount] + ')' : '') + ' at ' + (data['fexp_company_' + fexpCount] || '') + (data['fexp_country_' + fexpCount] ? ', ' + data['fexp_country_' + fexpCount] : '') + (data['fexp_hours_' + fexpCount] ? ' | ' + data['fexp_hours_' + fexpCount] + ' hrs/wk' : '') + (data['fexp_from_' + fexpCount] ? ' | ' + data['fexp_from_' + fexpCount] + ' to ' + (data['fexp_to_' + fexpCount] || 'Present') : ''));
                if (data['fexp_duties_' + fexpCount]) addField('Duties', data['fexp_duties_' + fexpCount]);
                fexpCount++;
            }

            // Canadian Work Experience
            let cexpCount = 1;
            while (data['cexp_title_' + cexpCount]) {
                if (cexpCount === 1) addSection('CANADIAN WORK EXPERIENCE', [124, 58, 237]);
                addField('Canadian Job ' + cexpCount, (data['cexp_title_' + cexpCount] || '') + (data['cexp_noc_' + cexpCount] ? ' (NOC: ' + data['cexp_noc_' + cexpCount] + ')' : '') + ' at ' + (data['cexp_company_' + cexpCount] || '') + (data['cexp_city_' + cexpCount] ? ', ' + data['cexp_city_' + cexpCount] : '') + (data['cexp_hours_' + cexpCount] ? ' | ' + data['cexp_hours_' + cexpCount] + ' hrs/wk' : '') + (data['cexp_permit_' + cexpCount] ? ' | Permit: ' + data['cexp_permit_' + cexpCount] : '') + (data['cexp_from_' + cexpCount] ? ' | ' + data['cexp_from_' + cexpCount] + ' to ' + (data['cexp_to_' + cexpCount] || 'Present') : ''));
                if (data['cexp_duties_' + cexpCount]) addField('Duties', data['cexp_duties_' + cexpCount]);
                cexpCount++;
            }

            // Blood Relation in Canada
            if (data.hasBloodRelation === 'yes') {
                addSection('BLOOD RELATIVE IN CANADA', [219, 39, 119]);
                addField('Relative Name', data.bloodRelName);
                addField('Relationship', data.bloodRelRelationship);
                addField('Status', data.bloodRelStatus);
                addField('Location', data.bloodRelLocation);
                addField('Whose Relative', data.bloodRelWhose);
                y += 5;
            }

            // Spouse CRS Details
            if (data.spouseAccompanying === 'yes') {
                addSection('SPOUSE/PARTNER CRS DETAILS', [124, 58, 237]);
                addField('Accompanying', 'Yes');
                if (data.spouseEduLevel) addField('Spouse Education', data.spouseEduLevel + (data.spouseEduCanada === 'yes' ? ' (in Canada)' : ''));
                if (data.spouseECA) addField('Spouse ECA', data.spouseECA);
                if (data.spouseEngTest) {
                    addField('Spouse English Test', data.spouseEngTest);
                    addField('Spouse Eng Scores (L/R/W/S)', (data.spouseEngL || '-') + '/' + (data.spouseEngR || '-') + '/' + (data.spouseEngW || '-') + '/' + (data.spouseEngS || '-'));
                }
                if (data.spouseFrTest && data.spouseFrTest !== 'none') {
                    addField('Spouse French Test', data.spouseFrTest);
                    addField('Spouse Fr Scores (L/R/W/S)', (data.spouseFrL || '-') + '/' + (data.spouseFrR || '-') + '/' + (data.spouseFrW || '-') + '/' + (data.spouseFrS || '-'));
                }
                if (data.spouseCanadianWorkYears && data.spouseCanadianWorkYears !== '0') addField('Spouse Canadian Work Exp', data.spouseCanadianWorkYears + ' year(s)');
                y += 5;
            }

            // Travel History
            let travelCount = 1;
            while (data['travel_country_' + travelCount]) {
                if (travelCount === 1) addSection('TRAVEL HISTORY', dark);
                addField('Trip ' + travelCount, (data['travel_country_' + travelCount] || '') + (data['travel_purpose_' + travelCount] ? ' (' + data['travel_purpose_' + travelCount] + ')' : '') + (data['travel_from_' + travelCount] ? ' | ' + data['travel_from_' + travelCount] + ' to ' + (data['travel_to_' + travelCount] || 'Present') : '') + (data['travel_duration_' + travelCount] ? ' | ' + data['travel_duration_' + travelCount] : ''));
                travelCount++;
            }

            // Absences from Canada
            let absenceCount = 1;
            while (data['absence_country_' + absenceCount]) {
                if (absenceCount === 1) addSection('ABSENCES FROM CANADA', red);
                addField('Absence ' + absenceCount, (data['absence_country_' + absenceCount] || '') + (data['absence_reason_' + absenceCount] ? ' (' + data['absence_reason_' + absenceCount] + ')' : '') + (data['absence_from_' + absenceCount] ? ' | ' + data['absence_from_' + absenceCount] + ' to ' + (data['absence_to_' + absenceCount] || 'Present') : '') + (data['absence_days_' + absenceCount] ? ' | ' + data['absence_days_' + absenceCount] + ' days' : ''));
                absenceCount++;
            }

            // Language
            if (data.englishTest || data.frenchTest) {
                addSection('LANGUAGE', [6, 182, 212]);
                if (data.englishTest) {
                    addField('English Test', data.englishTest);
                    addField('English Scores (L/R/W/S)', (data.engL || '-') + '/' + (data.engR || '-') + '/' + (data.engW || '-') + '/' + (data.engS || '-'));
                }
                if (data.frenchTest && data.frenchTest !== 'none') {
                    addField('French Test', data.frenchTest);
                    addField('French Scores (L/R/W/S)', (data.frL || '-') + '/' + (data.frR || '-') + '/' + (data.frW || '-') + '/' + (data.frS || '-'));
                }
            }

            // Background
            addSection('BACKGROUND', red);
            addField('Criminal', data.bg_criminal || 'No');
            if (data.bg_criminal === 'yes') addField('Details', data.bg_criminal_detail);
            addField('Visa Refusal', data.bg_refusal || 'No');
            if (data.bg_refusal === 'yes') addField('Details', data.bg_refusal_detail);
            addField('Health Issues', data.bg_health || 'No');
            if (data.bg_health === 'yes') addField('Details', data.bg_health_detail);

            // Additional
            if (data.additionalInfo) {
                addSection('ADDITIONAL INFO', dark);
                const lines = doc.splitTextToSize(data.additionalInfo, 160);
                checkPageBreak(lines.length * 5 + 10);
                doc.setTextColor(...dark);
                doc.setFontSize(9);
                doc.text(lines, leftMargin + 5, y);
                y += lines.length * 5 + 5;
            }

            // REFUGEE CLAIM FORM PDF
            if (data.ref_existing_claim) {
                addSection('REFUGEE CLAIM', [212, 36, 38]);
                addField('Existing Claim', data.ref_existing_claim);
                if (data.ref_claim_number) addField('Claim Number', data.ref_claim_number);
                addField('Height', data.ref_height);
                addField('Eye Color', data.ref_eye_color);
                addField('Native Language', data.ref_native_lang);
                addField('Interview Language', data.ref_interview_lang);
                addField('Contact Language', data.ref_contact_lang);
                addField('Entry Method', data.ref_arrival_method);
                addField('Entry Port', data.ref_entry_port);
                y += 5;
            }

            // FAMILY INFORMATION FORM PDF
            if (data.imm_app_type) {
                addSection('FAMILY INFORMATION (IMM 5645)', [124, 58, 237]);
                addField('Application Type', data.imm_app_type);
                addField('Applicant Name', data.imm_applicant_name);
                addField('Applicant DOB', data.imm_applicant_dob);
                if (data.imm_spouse_name) addField('Spouse Name', data.imm_spouse_name);
                if (data.imm_mother_name) addField('Mother Name', data.imm_mother_name);
                if (data.imm_father_name) addField('Father Name', data.imm_father_name);
                let famChild = 1;
                while (data['imm_child_name_' + famChild]) {
                    addField('Child ' + famChild, (data['imm_child_name_' + famChild] || '') + ' | ' + (data['imm_child_rel_' + famChild] || ''));
                    famChild++;
                }
                let famSib = 1;
                while (data['imm_sibling_name_' + famSib]) {
                    addField('Sibling ' + famSib, (data['imm_sibling_name_' + famSib] || '') + ' | ' + (data['imm_sibling_rel_' + famSib] || ''));
                    famSib++;
                }
                y += 5;
            }

            // H&C APPLICATION FORM PDF
            if (data.hc_declaration_name) {
                addSection('PERSONAL INFORMATION', blue);
                addField('Given Name(s)', data.givenName);
                addField('Family Name', data.familyName);
                addField('Date of Birth', data.dob);
                addField('Place of Birth', data.pob);
                addField('Sex', data.sex);
                addField('UCI Number', data.uci_number);
                addField('Citizenship', data.citizenship);
                addField('Other Citizenships', data.other_citizenship);
                y += 5;

                addSection('PASSPORT / TRAVEL DOCUMENT', dark);
                addField('Passport Number', data.passportNum);
                addField('Country of Issue', data.passport_country);
                addField('Issue Date', data.passportIssue);
                addField('Expiry Date', data.passportExpiry);
                y += 5;

                addSection('CONTACT INFORMATION', green);
                addField('Email', data.email);
                addField('Phone', data.phone);
                addField('Current Address', data.address);
                addField('City', data.city);
                addField('Province', data.province);
                addField('Postal Code', data.postalCode);
                addField('Country', data.country);
                y += 5;

                addSection('CURRENT STATUS IN CANADA', [249, 115, 22]);
                addField('Immigration Status', data.hc_current_status);
                addField('Status Document Number', data.hc_status_doc_number);
                addField('Status Expiry Date', data.hc_status_expiry);
                addField('Date of Entry to Canada', data.hc_entry_date);
                addField('Place of Entry', data.hc_entry_place);
                addField('Subject to Removal Order', data.hc_removal_order);
                y += 5;

                addSection('REFUGEE CLAIM HISTORY', [6, 182, 212]);
                addField('Previous Refugee Claim', data.hc_refugee_claim);
                addField('Claim Date', data.hc_claim_date);
                addField('Claim Outcome', data.hc_claim_outcome);
                y += 5;

                addSection('FAMILY INFORMATION', [124, 58, 237]);
                addField('Marital Status', data.maritalStatus);
                addField('Spouse Name', data.spouseName);
                addField('Spouse DOB', data.spouseDOB);
                y += 5;

                addSection('ESTABLISHMENT IN CANADA', [212, 36, 38]);
                addField('First Arrival Date', data.hc_first_arrival);
                addField('Years in Canada', data.hc_years_in_canada);
                addField('Continuous Residence', data.hc_continuous_residence);
                addField('Currently Employed', data.hc_currently_employed);
                addField('Employer', data.hc_employer_name);
                addField('Job Title', data.hc_job_title);
                addField('Annual Income', data.hc_employment_income);
                addField('Employment Type', data.hc_employment_type);
                addField('Studied in Canada', data.hc_studied_canada);
                addField('Institution', data.hc_institution);
                addField('Program', data.hc_program);
                addField('Languages', data.hc_languages);
                addField('English Proficiency', data.hc_english_proficiency);
                addField('Financial Support', data.hc_financial_support);
                y += 5;

                addSection('HARDSHIP ASSESSMENT', [236, 72, 153]);
                addField('Return Country', data.hc_return_country);
                const hardshipFactors = [];
                if (data.hc_hardship_healthcare) hardshipFactors.push('Lack of adequate healthcare');
                if (data.hc_hardship_mental_health) hardshipFactors.push('Mental health concerns');
                if (data.hc_hardship_discrimination) hardshipFactors.push('Risk of discrimination');
                if (data.hc_hardship_violence) hardshipFactors.push('Domestic violence/abuse');
                if (data.hc_hardship_political) hardshipFactors.push('Political instability/war');
                if (data.hc_hardship_education) hardshipFactors.push('Lack of education for children');
                if (data.hc_hardship_economic) hardshipFactors.push('Economic hardship');
                if (data.hc_hardship_family_separation) hardshipFactors.push('Separation from family');
                if (data.hc_hardship_country_conditions) hardshipFactors.push('Country conditions');
                if (hardshipFactors.length > 0) addField('Hardship Factors', hardshipFactors.join(', '));
                addField('Medical Conditions', data.hc_medical_conditions);
                addField('Mental Health Support', data.hc_mental_health_support);
                addField('Domestic Violence', data.hc_domestic_violence);
                y += 5;

                addSection('BEST INTERESTS OF THE CHILD', [139, 92, 246]);
                addField('Children Affected', data.hc_children_affected);
                addField('Number of Children', data.hc_bitc_children_count);
                const bitcFactors = [];
                if (data.hc_bitc_born_canada) bitcFactors.push('Child born in Canada');
                if (data.hc_bitc_school_canada) bitcFactors.push('Attends school in Canada');
                if (data.hc_bitc_medical_special) bitcFactors.push('Medical/special needs');
                if (data.hc_bitc_language_barriers) bitcFactors.push('Language barriers');
                if (data.hc_bitc_no_ties) bitcFactors.push('No ties to home country');
                if (data.hc_bitc_no_access) bitcFactors.push('Would lose access to education/healthcare');
                if (data.hc_bitc_family_separation) bitcFactors.push('Separation from parent(s)');
                if (bitcFactors.length > 0) addField('Child Factors', bitcFactors.join(', '));
                y += 5;

                addSection('EXEMPTIONS REQUESTED', [6, 182, 212]);
                const exemptions = [];
                if (data.hc_exempt_apply_outside) exemptions.push('Exemption from requirement to apply outside Canada');
                if (data.hc_exempt_inadmissibility) exemptions.push('Exemption from inadmissibility');
                if (data.hc_exempt_criteria) exemptions.push('Exemption from not meeting immigration class criteria');
                if (data.hc_exempt_other) exemptions.push('Other exemptions');
                if (exemptions.length > 0) addField('Exemptions', exemptions.join(', '));
                addField('Exemptions Details', data.hc_exempt_details);
                y += 5;

                addSection('ADDITIONAL INFORMATION', dark);
                addField('How Found Us', data.referral);
                addField('Preferred Language', data.preferred_language);
                addField('Declaration Date', data.hc_declaration_date);
                y += 5;
            }

            // CLIENT PROFILE FORM PDF
            if (data.declaration_name) {
                addSection('CLIENT PROFILE - INFORMATION RECORD', blue);
                addField('Full Name', data.givenName + ' ' + data.familyName);
                addField('Date of Birth', data.dob);
                addField('Place of Birth', data.pob);
                addField('Gender', data.sex);
                addField('Citizenship', data.citizenship);
                addField('Other Citizenship', data.other_citizenship);
                addField('Email', data.email);
                addField('Phone', data.phone);
                addField('Current Address', data.address);
                addField('City', data.city);
                addField('Passport Number', data.passportNum);
                addField('Passport Expiry', data.passportExpiry);
                addField('Current Status', data.current_status);
                addField('Status Expiry', data.status_expiry_date);
                addField('In Canada', data.in_canada);
                addField('Previous Canada Application', data.prev_canada_app);
                addField('Marital Status', data.maritalStatus);
                addField('Dependent Children', data.num_children);
                addField('Immigration Service Sought', data.service_seeking);
                addField('Preferred Language', data.preferred_language);
                addField('How Found Us', data.referral_source);
                addField('Declaration Date', data.declaration_date);
                y += 5;
            }

            // Footer
            const totalPages = doc.internal.getNumberOfPages();
            for (let i = 1; i <= totalPages; i++) {
                doc.setPage(i);
                doc.setFillColor(240, 240, 240);
                doc.rect(0, 285, 220, 15, 'F');
                doc.setTextColor(100, 100, 100);
                doc.setFontSize(8);
                doc.text('Waymark Immigration | 604-750-8846 | www.waymarkimmigration.ca', 105, 292, { align: 'center' });
                doc.text('Page ' + i + '/' + totalPages, 195, 292, { align: 'right' });
            }

            return doc.output('blob');
        }

        // PDF download is now handled inline in handleSubmit

        async function sendEmail(formData, pdfBase64, hasPdf) {
            const formType = document.getElementById('formType').value;
            const config = FORM_CONFIG[formType];
            const clientName = `${formData.givenName || ''} ${formData.familyName || ''}`.trim() || 'Unknown';

            console.log('Sending email to worker...');

            try {
                const response = await fetch('https://waymark-immigration-forms.sukhveeriphone.workers.dev/send-email', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        applicationData: formData,
                        pdfBase64: pdfBase64 || '',
                        fileName: getFileName(),
                        clientEmail: formData.email || '',
                        clientName: clientName,
                        applicationType: config?.name || formType,
                        deviceType: isMobile ? 'mobile' : 'desktop',
                        pdfIncluded: hasPdf
                    })
                });

                console.log('Response status:', response.status);
                
                const result = await response.json();
                console.log('Response body:', result);
                
                return { success: result.success, error: result.error };
            } catch (error) {
                console.error('Fetch error:', error);
                return { success: false, error: error.message };
            }
        }

        function blobToBase64(blob) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => {
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });
        }

        function showToast(msg, type) { 
            const t = document.getElementById('toast'); 
            t.textContent = msg; 
            t.className = 'toast ' + (type === 'error' ? 'error' : '') + ' show'; 
            setTimeout(() => t.classList.remove('show'), 5000); 
        }

        window.onload = function() {
            // Check for form type in URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            const formType = urlParams.get('form');
            
            if (formType && FORM_CONFIG[formType]) {
                document.getElementById('formType').value = formType;
                generateForm();
                showToast('üìã Form ready! Please fill in your details.', 'success');
            } else {
                // Check for saved data
                const saved = localStorage.getItem('waymark_form_data');
                if (saved) { 
                    const data = JSON.parse(saved); 
                    if (data._savedAt) document.getElementById('lastSaved').innerText = "Found: " + data._savedAt; 
                }
            }
        }

        // Share Form Function
        function shareForm() {
            const formType = document.getElementById('formType').value;
            if (!formType) {
                showToast('‚ö†Ô∏è Please select a form type first', 'error');
                return;
            }

            const config = FORM_CONFIG[formType];
            const baseUrl = window.location.origin + window.location.pathname;
            const shareUrl = baseUrl + '?form=' + formType;

            // Try to copy to clipboard
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(shareUrl).then(() => {
                    showShareSuccess(config.name, shareUrl);
                }).catch(() => {
                    fallbackCopy(shareUrl, config.name);
                });
            } else {
                fallbackCopy(shareUrl, config.name);
            }
        }

        function fallbackCopy(text, formName) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showShareSuccess(formName, text);
            } catch (err) {
                // Show the link in a prompt so user can copy manually
                prompt('Copy this link to share:', text);
            }
            
            document.body.removeChild(textArea);
        }

        function showShareSuccess(formName, url) {
            showToast('‚úÖ Link copied! Share with your client.', 'success');
            
            // Also show a more detailed modal/alert on desktop
            if (!isMobile) {
                setTimeout(() => {
                    alert('üìã ' + formName + ' link copied!\n\nShare this with your client:\n' + url + '\n\nThey can fill the form directly and submit.');
                }, 100);
            }
        }

        // Native share for mobile (optional - uses device share menu)
        async function nativeShare() {
            const formType = document.getElementById('formType').value;
            if (!formType) {
                showToast('‚ö†Ô∏è Please select a form type first', 'error');
                return;
            }

            const config = FORM_CONFIG[formType];
            const baseUrl = window.location.origin + window.location.pathname;
            const shareUrl = baseUrl + '?form=' + formType;

            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'Waymark Immigration - ' + config.name,
                        text: 'Please fill out this immigration form:',
                        url: shareUrl
                    });
                    showToast('‚úÖ Shared successfully!', 'success');
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        // User didn't cancel, fallback to copy
                        shareForm();
                    }
                }
            } else {
                shareForm();
            }
        }
    </script>
</body>
</html>
